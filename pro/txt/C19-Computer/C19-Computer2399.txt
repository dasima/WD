计算机研究与发展
JOURNAL OF COMPUTER RESEARCH AND DEVELOPMENT
1999年　第36卷　第10期　Vol.36　No.10　1999



IP组播和INTERNET上的视频广播
何刚　吴志美
　　摘　要　文中介绍了IP组播的概念、D类IP地址以及IP组播的加入、退出，阐述了IP组播的路由两种路由表的构成以及各自的特点，讨论了IP组播的范围，对IP组播安全机制作了比较详细的描述，介绍了IP组播密钥管理，以及组播站点如何获得密钥并用它来进行IP安全组播.然后就IP组播的可靠传输进行了讨论，比较了IP组播的优缺点；然后介绍了IP组播的一种应用――Internet上的视频广播，详细说明了Internet上的视频广播网络的构成，并且对Internet上的视频广播的服务质量进行了讨论.
　　关键词　组播，D类地址，视频广播，密钥管理，可靠传输
　　中图法分类号　TP399.03
IP MULTICAST AND IP TV ON INTERNET
HE Gang and WU Zhi-Mei
(Institute of Software, Chinese Academy of Sciences, Beijing 100080)
　　Abstract　First introduced in the paper here is the concept of IP multicast and D class IP addresses. It is shown how an IP workstation can join and leave a multicast group, and maintain its membership in the multicast group. Routing in multicast is also different from that in unicast. The paper gives the forms of two different routing trees, and shows the differences of these trees. Then it shows the scope of IP multicast. Securities in multicast are discussed in detail. The paper also describes how the security keys are managed, how a workstation gets a key for secure multicast, and how the key is used in data transmission. Reliable data transmission in multicast is discussed too. The second part of the paper gives an example of using IP multicast-IP TV. The architecture of IP TV is outlined, four kinds of workstations in IP TV are shown, and then its quality of service is discussed.
　　Key words　multicast, class D address, TV broadcast, key administration, reliable transmission
1　IP组播
　　IP协议版本4.0定义了3种IP数据包的传输：点到点的传输、全网广播和组播.点到点的传输指的是两台IP站点进行的数据传输，这种传输是最常见的IP传输；全网广播指的是在IP子网内广播数据包，所有在子网内部的IP站点都能够收到这种数据包；组播指的是在Internet网上对一组IP站点进行数据传送，这一组IP站点是动态形成的，每一个IP站点都可以动态地加入或者退出这个组.Internet标准委员会IETF在1992年建立了一个Internet上IP组播的主干，并命名为Mbone，用来进行IP组播的实验.
1.1　D类地址
　　IP组播和点到点传输的数据报只有一点不同，即IP组播的目的地址是组地址――D类地址.D类地址是从224.0.0.0到239.255.255.255之间的IP地址，其中224.0.0.0到224.0.0.255是被保留的地址,224.0.0.1表示子网中所有的组播组, 224.0.0.2表示子网中的所有网关.
　　D类地址是动态分配和恢复的瞬态地址.每一个组播组对应于动态分配的一个D类地址；当组播组结束组播时，相对应的D类地址将被回收，用于以后的组播.在D类地址的分配中，IETF建议遵循以下的原则：　　
　　全球范围：224.0.1.0～238.255.255.255；
　　有限范围：239.0.0.0～239.255.255.255；
　　本地站点范围：239.253.0.0～239.253.0.16；
　　本地机构范围：239.192.0.0～239.192.0.14.
1.2　组播组的加入和退出
　　IGMP协议［1］运行在IP站点和它所在的子网多点路由器之间，用来控制组播组成员的加入和退出.
　　(1) 组播组的加入
　　每一个IP站点可以通过访问某一个特定的WWW站点，或者以E-mail的形式获得它所感兴趣的组播组的地址，如MG1.当某个IP站点加入某一个组播组MG1时，它需要通知它所在的IP子网的组播路由器，组播组MG1是它所想要加入的，同时将自己的IP模块准备开始接受从特定的组播组MG1传来的组播数据；如果该IP站点是它所在的IP子网中第一个加入组播组MG1的，通过路由信息的交换，组播路由器将要加入组播组MG1的分配树(有关分配树在1.3节中进行讨论).这是一种由接收方来初始化的加入方法，在组播组的数据越来越多的时候，这种方法可以使新加入的组播组成员尽快找到离它很近的组播组的分支，从而加入组播组.
　　(2) 组播组的退出
　　在IGMP 1.0中，当每一个IP站点离开某一个组播组时，它不通知任何人就自然地离开，组播路由器定时(如120秒)向IP子网中的所有组播组询问，如果某一个组播组在IP子网中已经没有任何成员，则组播路由器在确认这一事件后，不再将该组播组的数据在子网中进行传送，同时通过路由信息的交换，将相应的组播路由器从特定的组播组分配树中删除.这种不通知任何人而悄悄离开的方法，使得组播路由器知道IP子网中已经没有任何成员的事件延时了一段时间，所以在IGMP 2.0中，当每一个IP站点离开某一个组播组时，需要通知子网组播路由器，组播路由器立即向IP子网中的所有组播组询问，从而减少了系统处理停止组播的延时.
1.3　IP组播的路由
　　IP组播的路由［2］的关键是为每一个组播组建立组播的分配树，当组播的分配树建立好时，每个组播路由器只要将该组播组的数据沿着分配树进行传播就可以了.组播的分配树具体的形成过程可以参见文献［3］到文献［5］.组播的分配树有两种：有源的分配树和无源的分配树.
　　(1) 有源的分配树
　　有源的分配树是指对于一个组播组，每个组播路由器都形成一个分配树，可以表示为T(S,G)，其中S表示该组播路由器，G表示该组播组，这样组播组路由器一共存储了O(S×G)个分配树，需要较多的组播路由器系统的内存；同时，为了计算每一个组播路由器到其他同一组播组路由器的最短距离，从而形成一个最优的分配树，也需要消耗较多的组播路由器系统时间，交换更多的路由信息；但是这种分配树一旦形成，对于每一个组播路由器来说，分配树都是最优的，从而能够达到较高的传输效率.如图1所示，从每一个源站点到每一个目的站点都有一条最佳组播路径.


图1　组播的路由分配树
　　这种组播的路由分配树适合于组播的站点比较密集、组播数据比较多的情况，可以使每一个组播数据报都能够以最优的传送方式到达接收站点.
　　(2) 无源的分配树
　　无源的分配树是指对于一个组播组，以一个特定的组播路由器为共享根，形成一个分配树，可以表示为T(*,G)，其中*表示所有组播路由器，这样组播组的路由器一共存储了O(G)个分配树，减少了组播路由器系统内存的需求，也减少了分配树形成所消耗的组播路由器系统时间；但是这种分配树对于某些组播路由器来说，可能达不到很好的传输效率.如图1所示，组播路由器A本来可以直接传送组播数据到组播路由器E，但是在无源的分配树这种路由算法中，不得不通过组播路由器B和组播路由器C.
　　这种组播的路由分配树适合于组播的站点比较稀疏、组播数据比较少的情况，可以减少路由器的路由信息交换和形成的开销.
1.4　IP组播的范围
　　IP数据报头有一个数据域TTL(生存时间)，每通过一个组播路由器，TTL都要减少一个特定的常量，当TTL=0时，路由器将IP数据报扔掉.IP组播数据的发送者可以指定TTL的初始值，以控制数据的发送范围；而网络管理员可以通过对组播路由器的配置，将TTL的值减少为0，从而将所有的组播数据只在子网内部进行传送.
　　由于IP组播组地址的分配是动态的，如果只希望在自己的子网或者自己完全能够控制的自治域中进行组播，那么可以按照自己的需求任意分配使用组播组地址，在边缘的组播路由器有责任将所有IP组播的数据和路由信息都过滤掉；如果希望和其他子网或者不能够完全控制的自治域进行组播，那么必须遵循相应的地址分配规则(IETF的分配规则见第1.1节)，和其他子网或者不能够完全控制的自治域协商分配.
　　目前有许多现存的路由器还不支持IP组播，所有邻近的支持组播的路由器和他们所在的子网可以形成一个“组播岛”，“组播岛”之间的路由器都不支持IP组播，组播的数据就必须封装在点到点的IP数据报中，穿过“组播岛”之间的路由器，在“组播岛”之间传递IP组播数据报.Mbone就是由许多的“组播岛”构成的.
1.5　IP组播的安全
　　IP组播的安全问题目前还没有正式形成标准协议，有关IP组播的安全功能对于组播路由器都是可选的.　　
　　(1) 组播密钥的管理
　　点到点安全机制［6～8］中的传送密钥管理通常引入密钥管理中心，每一个IP站点都可以到密钥管理中心去认证自己，并获得其他IP站点的公开密钥.这种方法对于组播并不适用，组播的站点可能非常多，必须采用组播的特点来进行密钥管理.
　　组播密钥的管理［9］要为每一个组播组(以下简称MG)建立一个专门的密钥管理组播组(以下简称KMG)，KMG的组播组地址和MG一样，但是路由可以和MG不一样，传送的都是有关密钥管理的信息，组播路由器通过传送的内容决定路由的方式.通常KMG的分配树采用无源的分配树(如CBT，参见文献［10］)，这样初始密钥的管理可以集中到共享根的节点上.
　　下面以组播组的安全加入和安全广播的过程来介绍组播密钥的管理和使用.
　　(2) 组播组的安全加入
　　组播组的创建者X首先发出一个创建组播组MG1的消息SC_MG1，包含X的身份和MG1的访问权利表ACL_MG1等等，用自己的私用密钥sk_X传送给自己所在子网的组播路由器A，A用X的公开密钥pk_X确认X的身份，然后将SC_MG1用A的私用密钥加密，用密钥管理组播组KMG1继续传递，直到安全送给共享根C.C确认X的身份和权利，如果X可以创建MG1，则C创建MG1的密钥k_MG1，保存ACL_MG1，采用类似的加密方法传送回X.所有从C到X的组播路由器都必须经过身份和权利的认证，如果成功，则该组播路由器为“安全”的，可以获得K_MG1和ACL_MG1，否则表示“不安全”的组播路由器.
　　MG1的加入者Y发出一个安全加入的消息SJ_MG1，类似上面的加密传送机制，在KMG1中传递，直到第一个“安全”的组播路由器B，B从SJ_MG1中取出Y的身份，从保存的ACL_MG1中确认Y的权利，如果Y能够加入MG1，发送加入确认给Y，并将K_MG1用类似上面的加密传送机制传送给Y，否则发送加入拒绝给Y.
　　(3) 组播组的安全广播
　　Y安全加入了MG1之后，就可以接收和发送组播数据报，发送时将数据报用k_MG1加密发送；接收时用k_MG1解密数据.
　　当需要确认发送者身份的发送时，Y必须利用KMG1首先将它的公开密钥pk_Y广播给所有的接收者；然后将自己发送的组播数据报用自己的私用密钥sk_Y作数据签名，再用k_MG1加密发送出去.接收方发现组播数据报来自Y，首先用K\-MG1解密，然后再用pk_Y确认发送者的身份，这样就可以正确地收到来自Y的组播数据报，同时，能够确认组播数据报是Y发送的.
　　如果节点Z还不是MG1的成员，他必须首先和共享根进行通信，得到授权后，获得k_MG1，并将自己的公开密钥pk_Z通过C广播给MG1的成员.然后类似Y发送数据报即可.
1.6　IP组播的可靠组播
　　保证IP组播的可靠性需要对所广播的数据包进行确认.由于对每一个发送的数据包都有一个或者多个接收者，这样，在接收者数目很大时，将所有的确认包都回送给发送者会使发送者不堪重负.因此，可以将确认包进行分级确认，每一个接收者将确认包发给最低级的确认站点Confirm_L(n)，如果Confirm_L(n)收到的都是正确接收，将发送一个“正确接收”的确认包给上一层的确认站点Confirm_L(n-1)，否则发送一个“接收错误”的确认包给Confirm_L(n-1)；这样发送者只要和最高级的确认站点Confirm_L(1)进行通信就可以确认接收者是否都收到发送的数据包，如果是“正确接收”的确认包，可以继续发送，如果是“接收错误”的确认包可以进一步和各级确认站点通信，查询没有正确收到数据的接收者，进行错误恢复等一系列措施.
　　IP组播的确认站点的形成、可靠组播的确认方式以及重传机制目前都还在研究中.
1.7　IP组播的优点和缺点
　　当某个IP站点向Internet上的多个IP站点发送同一数据时，IP组播可以减少不必要的重叠发送，有效地利用网络的带宽，而且虽然增加了IP组播相关协议的处理，相对于多次相同的点到点的传输来说，仍旧减少了大量组播路由器和主机对于IP报的处理时间.
　　由于许多IP组播的路由协议的并存，及目前许多路由器还不支持IP组播使得IP组播的应用受到了一定的限制；而且目前，IP组播的可靠传输还在研究中，所以，IP组播多应用于对传输的可靠性要求不高的多媒体通信中，Internet上的视频广播就是其中之一.
2　Internet上的视频广播
　　目前视频广播主要是通过电视网络，电视网络经过几十年的普及，已经成为生活中不可缺少的一部分，而多媒体技术的进步，计算机网络技术的迅速发展，尤其是组播技术的发展使得在计算机网络上传输视频的技术逐渐成熟，Internet为视频广播提供了一个新的途径.
2.1　Internet视频广播网络的构成
　　Internet视频广播网络建立在已经存在的Internet网络之上，定义了4种IP站点：IP视频广播的发送站点、转发站点、接收站点和控制站点.它们的关系如图2所示.


图2　Internet上视频广播网络的构成
　　(1) 视频广播的发送站点
　　发送站点可以发送已经制作好的节目，或者发送实时的视频图像，通过转发站点发送给接收站点.通常将发送站点和转发站点不设在同一台计算机上，发送站点和转发站点之间建立点到点的连接，为了保证发送的质量，通过RSVP［11］等协议来保证传输的服务质量.
　　(2) 视频广播的转发站点
　　转发站点的主要作用是将发送站点发来的视频通过Internet网络转发给视频广播的接收站点或者下一级的转发站点.转发站点是IP视频广播的核心，它将发送站点送来的视频信息采用组播的方式转发下去，IP的组播技术为Internet的视频广播提供了技术基础.由于视频多媒体的特点，并不需要可靠地传输到接收站点，转发站点只要作到尽可能地发送就可以了.
　　转发站点有时还需要采用点到点的传输，将广播的内容通过不支持IP的组播路由器，转发到下一级的转发站点，由下一级的转发站点再用组播的功能转发给接收站点.
　　(3) 视频广播的接收站点
　　接收站点是用户的多媒体终端.用户的多媒体终端必须支持IP的组播；对于特定的多媒体信息，还必须支持相应的解压缩模块；接收站点还必须提供一些缓冲和平滑手段，以保证多媒体信息在接收站点很好地回放.　　
　　(4) 视频广播的控制站点
　　控制站点的主要功能是对转发站点进行控制，用来建立和管理转发站点上的Internet的广播小组.
2.2　IP视频广播的服务质量
　　与通常的Internet应用程序(如FTP，telnet)不同，IP视频广播所传输的是多媒体数据，IETF定义RTP协议［12］来传输多媒体数据，多媒体的传输不能够仅仅满足于尽可能的传输效果，而不考虑传输的时延以及时延的变化，多媒体传输的时间相关性决定了IP视频广播必须满足一定的传输服务质量.
　　(1) IP视频广播的可用带宽
　　IP视频广播采用的压缩和解压缩算法决定了IP视频广播是一个可变速率的应用程序，它所需要的传输带宽是可变的，为了满足一个较好的视频节目接收效果，必须为IP视频广播保留一定的传输可用带宽.
　　(2) IP视频广播的延时
　　IP视频广播对于延时要求并不是很高，除非是为了尽快地得到实况转播节目.
　　(3) IP视频广播的抖动
　　抖动在多媒体传输的过程中是很敏感的，对于一个视频节目来说，抖动会使接收到的视频在回放时时断时续，所以，IP视频广播必须克服抖动，采取增加系统缓冲的方法，宁肯增加系统的延时.
　　目前，保证IP视频广播的服务质量的方法有两种：ATM技术和RSVP协议.ATM技术能够保证端到端的传输服务质量，但是，目前大多数局域网还不支持ATM的传输，RSVP协议应用在已有的IP网络上，为IP网络提供了支持传输服务质量的扩展.
2.3　IP视频广播的优点和缺点
　　IP视频广播能够在已有的Internet网络上进行视频广播，不需要建立一个新的网络，而且由于Internet网络传输费用低，涵盖面广，可以很方便地建立一个IP视频广播网络.IP视频广播所传输的是数字视频信息，不会在传输中出现信号衰减.IP视频广播的主要缺点是Internet网络传输多媒体所固有的，它对于传输的服务质量，如延时、抖动等都不能够很好解决，而且由于目前的Internet网络传输带宽的限制，还不能够提供很高质量的视频节目.
本课题得到国家“九五”攻关项目基金资助.
作者简介：何刚，男，1971年10月生，博士研究生，主要研究领域为网络互联技术、多媒体通信技术.
　　　　　吴志美，男，1942年12月生，研究员，博士生导师，主要研究领域为网络互联技术、多媒体通信技术、ISDN通信技术、ATM通信技术.
作者单位：中国科学院软件研究所　北京　100080
参考文献
　1　　Deering S E. Host extensions for IP multicasting. Internet Engineering Task Force(IETF), Tech Rep: RFC1112, 1989
　2　　Johnson V, Johnson M. Introducing to IP Multicast Routing. Stardust Technology Inc, 1997 
　3　　Deering S. Distance vector multicast routing protocol. IETF, Tech Rep: RFC1075, 1988
　4　　Moy J. Multicast extensions to OSPF. IETF, Tech Rep: RFC1584, 1994
　5　　Estrin D. Protocol independent multicast-sparse mode (PIM-SM): Protocol specification. IETF, Tech Rep: RFC2117, 1997
　6　　Atkinson R. Security architecture for the Internet protocol. IETF, Tech Rep: RFC1825, 1995
　7　　Atkinson R. IP authentication header. IETF, Tech Rep:RFC1826, 1995
　8　　Atkinson R. IP encapsulating security payload. IETF, Tech Rep:RFC1827, 1995
　9　　Ballardie A. Scalable multicast key distribution. IETF, Tech Rep: RFC1949, 1996
　10　　Reeve A S, Jain N. Core based tree (CBT) multicast-protocol specification. IETF, Tech Rep: Work in Progress, 1996
　11　　Braden R E, Zhang L, Berson S et al. Resource reservation protocol (RSVP)-version 1 functional specification. IETF, Tech Rep: RFC2205, 1997
　12　　Schulzrinne H, Casner S, Frederick R. RTP: A transport protocol for real-time applications. IETF, Tech Rep: RFC1889, 1996 
原稿收到日期：1997-12-18；
修改稿收到日期：1998-05-05.
