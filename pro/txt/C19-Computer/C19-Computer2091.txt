计算机工程
COMPUTER ENGINEERING
1999年 第25卷 第10期 Vol.25 No.10 1999



一个基于IC卡数据采集技术的区域巡逻监察系统
伍卫国　王刊良　冯耕中
摘要：在保安工作中，客观及时地记录巡逻员工的工作情况，不公有利于对其工作过程进行监督，而且也有利于管理人员对巡逻员工的工作绩效作出合理的评价，这对于保安工作的有效进行是十分重要的。针对一个已经研制成功的基于IC卡技术的区域巡逻监察系统，探讨了该类系统的主要作用、系统的总体设计思路和目标、系统实施的技术要点以及系统的特色，同时也讨论了系统的应用领域和前景。
关键词：IC卡；单片机；监察系统；数据采集；区域巡逻
A Regional Patrol Monitoring System Based on IC Card Data Collection Technology
Wu Weiguo Wang Kanliang Feng Gengzhong
（Computer Department of Xi’an 710049）
【Abstract】Objective,timely and precise recording of employee's process and performance for security work is appropriate not only for the monitoring of employee's word process,but also for the rational evaluation of patrolling employee's performance by management,which is crucial to the effective security work.The present paper exploited the motivations,functions,major design approach and objectives,technical know-how in implementation and features of such system in the context of a developed regional patrol monitoring system.Potential aress of application and future perspectives were disscussed.
【Key words】IC card(Smart card);Single chip mierocomputer;Monitoring system;Data collection;Regional patroling
1　问题的提出
　　工业制造企业、货场、物业管理公司以及其它厂矿等组织为了对自己所拥有的财物进行有效的保护，防止火灾和其它事故在自己组织内发生从而为组织带来损失，必须采取有效措施对所属区域进行巡查，监督所属区域内非正常现象并进行及时处理。从这个动机出发，大多数有一定规模的厂家、货场、物业管理公司均设置有保卫部门，这个部门的主要职责就是监督员工是否遵守厂规、执行防火防盗等措施，为确保正常生产服务。其中一项重要的日常工作是在厂区内进行巡逻，发现不正常现象并进行及时处理。但是，如何对巡逻员工进行考核呢？尤其是夜间巡逻时，若没有相应的指标和手段进行切实考核，只要一段时间“相安无事”，巡逻员工容易产生麻痹心理，无法真正达到(夜间)巡逻的目的；另一方面，对主管而言也很难正确评价每一巡逻员工的工作质量。
　　针对上述问题，日本曾经开发出一种称之为“巡逻卡钟”的便携机械装置，其原理是在各巡逻要点放置标志该点的钥匙(钥匙上有两位凸起的数字编号，如“22”)，“卡钟”内可放入一张随钟表同步转动的专用纸片(上面标有24小时刻度)；巡逻人员持卡钟到厂区各要点巡逻时，取下各要点的钥匙，插入卡钟用力转动便将相应位置号(即钥匙上的数字编号)记录在纸片的相应时间刻度上；第二天取出纸片据以记录巡逻详细情况。上述措施有许多缺陷：第一，数据记录方式原始，需要人工将原始形式数据转换为可阅读的表格形式；第二，数据记录不准确，误差大约有2- 3分钟；第三，规模难以扩展，其巡逻要点上限为30个；第四，卡钟大约有1.5kg，携带起来太重；第五，安全性不好，钥匙容易复制，可能出现在办公室假巡逻的情况；第六，该系统没有设计配套的上位机分析处理软件。
　　为了克服巡逻卡钟的缺陷并达到对巡逻员工考核管理的目的，我们采用日臻成熟的IC卡技术、单片机技术和PC机上的类GIS界面技术开发了一个区域巡逻监察系统。
2　系统总体分析与设计
2.1 系统设计目标
　　管理信息系统(MIS)的主要目的在于帮助管理者从信息方面更出色地完成管理的各项任务，提高组织的效率和效能。巡逻员工监察系统的设计目标则是通过客观地提供员工工作情况，为组织的“激励系统”提供公正的、可信的数据，增进上级对下级的了解，进而提高巡逻员工的积极性、改进工作态度。区域巡逻监察系统可作为对巡逻员工的“业绩考核”工具，按考核结果可科学地对巡逻员工进行经济上的奖励或惩罚、加薪或晋升等。因而，对于生性懒惰而不认真执行巡逻任务的员工，利用监察系统可对其工作过程进行事后监督，使其没有多少偷懒的机会；对于积极认真执行巡逻工作的员工而言，该系统应如实反映其工作业绩，结合激励系统，更可促进其工作热情和积极性。
2.2  总体设计思路和运作原理
　　(1) 系统总体设计思路
　　为了对巡逻员工(尤其是夜间)进行监察，达到确保区域安全的目的，区域巡逻监察系统必须准确记录如下数据：
　　1) 巡逻员工，是甲员工而不是乙员工执行巡逻任务，即必须核实特定巡逻员工的身份；
　　2) 位置，巡逻员工途经的关键位置(或区域要点)；
　　3) 时间，巡逻员工什么时候到达了该位置；
　　4) 异常现象，在员工巡逻过程中随时发现的异常情况，如漏水、裂缝、烟火隐患等。
　　对于巡逻员工的身份，采用IC卡进行标识，即每一巡逻员工用一张IC卡(员工卡)标识身分；而每一关键位置也设有一张IC卡，称为位置卡(作用同“巡逻卡钟”的钥匙)。IC卡具有价格低、保密性强、几乎不可能复制等特点，所以，本系统采用IC卡进行员工标识和位置标识。
　　一般地讲，区域巡逻监察系统应该成为：1)工作指示器，即可以由管理人员设定巡岗执勤员工和巡岗线路，该线路是不固定的，每个班次可以设置不同线路，这样有助于杜绝巡逻执勤员工同不法人员勾结而进行违法活动，在工作过程中，上岗员工和巡岗过程都要按照该项工作指示来进行；2)工作记录器，每到达一个关键位置，巡岗员工都必须及时将其员工卡和位置卡插入便携式数据采集器(一种数据记录设备，其作用类似于巡逻卡钟)，此时到岗位置、到岗时间便自动记录下来，时间来自便携式数据采集器的实时时钟，同时指定巡岗员工必须带着其员工卡到达各巡岗位置；3)工作考核器，巡岗工作结束后，管理人员可以依据工作指示和巡岗员工的实际工作记录进行对比分析，检查巡岗员工的工作和区域安全情况，这样可以客观地对巡岗员工作出业绩考核，同时杜绝重大隐患问题的发生。
　　(2) 系统组成及其运作原理
　　该系统由两个部分组成：①上位机部分：上位机运行区域巡逻监察系统软件或称上位机软件；②硬件部分：称为便携式数据采集器或称为下位机。
　　①上位机部分：上位机软件在PC硬件平台上Windows环境下采用面向对象的开发工具Delphi语言进行开发。它一方面提供系统设置功能，如位置点的设定、各位置点检查内容的设定、巡岗线路的设定、异常情况编码的设置，同时进行工作参数如时钟、每次工作前的巡岗员工和巡岗线路的设定等；另一方面，各关键位置到达人次情况分析、员工到达各关键位置次数分析、异常情况查询、员工阶段业绩评价等。
　　②硬件部分：便携式数据采集器是一种用MCS-51单片机开发的低功耗IC 卡读写设备，主要功能是巡岗过程中向员工提供工作指示并进行实际工作记录，它通过RS232C与上位机部分相连以获取工作指示参数，并向上传输实际工作记录信息，而在巡岗过程中脱机独立使用。
　　区域巡逻监察系统的运作过程如图1所示。

图1 区域巡逻监察系统的运作过程示意图
　　运作过程说明如下。
　　・ 上班前，管理人员将值班巡逻员工、巡逻路线等参数从上位机(PC机)利用RS232C接口设置到便携式数据采集器中，只有管理人员才能有效操作该数据采集器；
　　・ 上班时，值班巡逻员工到办公室领取一个数据采集器，按数据采集器提示依次到各巡逻要点巡查，并将自己的员工卡和相应位置卡按提示插入到该便携式数据采集器中进行信息记录；
　　・ 下班后，巡逻员工将便携式数据采集器交回办公室管理人员处并一同拿到上位机利用RS232C将巡逻过程数据传到上位机以进行分析和处理。
　　在上位机软件设计方面，除了考虑同下位机数据通信之外，更重要的是区域巡逻结构的设置(如关键位置、巡查内容、巡逻路线等)以及对员工巡逻过程数据的进一步分析处理。对用户而言，该软件的一项主要指标是应具备良好的交互能力。由于该系统涉及到区域上的点和线，在区域平面图上进行位置点和线路操作并进行信息对比分析是有利于用户操作的，因此采用类GIS界面技术进行系统开发是十分必要的。
3　上位机软件的实施要点
　　上位机软件应有较强的交互能力，必须具有类似GIS那样的交互式界面，基于此，采用面向对象的Delphi语言开发了这样一个专用的类GIS 界面，界面的友好性表现在如下几个主要方面：
　　1) 菜单和快捷按钮均可提供同等效果的功能；
　　2) 鼠标点一下窗口中任一对象(如关键位置点、线路中的线段、地图等)均可给出相应对象的信息；
　　3) 上下文敏感的联机帮助系统；
　　4) 图形信息显示方式和表格信息显示方式并存；
　　5) 图形分析方式下查询结果显示在相关的位置点上，便于信息的对比分析。
　　该类GIS界面实现的基本思路是：将某区域平面图的BMP文件作为窗口的背景(Image)，关键位置和线路(线段)作为其中的对象动态生成，位置和线路由专门的地理信息表存放，从而构成了区域巡逻系统的基本框架，无论是设置关键位置、线路等还是查询巡逻信息均可只用鼠标在区域平面图上轻松完成。在上述工作的实施过程中，关键解决了如下5个问题：
　　1) 利用Delphi开发了表示巡逻关键位置的部件(称之为位置部件)，它是以现有的TShape部件导出，增加了Caption,Font,Brush等属性而成。
　　2) 利用动态数组实现了动态生成位置部件的功能，在生成位置部件的同时，设置该部件相应的事件处理能力。
　　3) 利用Delhpi的 Canvas(画布)功能实现了线路的方向化，给出巡逻路线方向的标识。
　　4) 应用图论算法对所设置巡逻路线进行有效性检查，经过仔细分析，发现巡逻路线从设置和实际行走方面均属欧拉图，因而在实施过程中利用一笔画算法对所设置的线路线段顺序进行排序，从而使巡逻线段的行走顺序同设置顺序无关。
　　5) 用Delphi开发了字模传输程序。由于便携式数据采集器用作工作指示器，用编码来指示巡逻位置难于记忆、也不明确，所以采用了汉字来指示。但是，下位机容量十分有限，不可能存放所有甚至是常用汉字的字模。因而，在设置巡逻路线和有关参数的同时，将各巡逻位置的汉字描述的汉字字模传输到下位机。
4　下位机的实施要点
　　下位机的主要功能是进行数据采集。在数据采集过程中，第一，它必须对员工身份卡进行确认，以便确认该员工是上位机所设置的巡逻员工而不是其它员工；第二，它必须阅读位置卡以记录相应员工到达相应位置的位置编号及到达时间；第三，为了保证巡逻的安全性，巡逻员工不可预先知道自己确切的巡逻路线，因而只随时提供下一待巡逻位置而非所有巡逻位置的汉字描述查询；第四，巡逻员工在巡逻过程中发现异常要能够记录下来。此外下位机还包括同上位机的通信功能：第一，接收上位机传送来的巡逻参数，由于下位机没有硬汉字字库，因而有关巡逻描述等汉字信息要传至下位机，下位机在巡逻位置查询时显示这些点阵汉字；第二，将巡逻过程的工作记录传至上位机，这些信息包括：巡逻员工、到达各位置的位置编号和时间等。为了满足上述功能，我们用MCS-51系列单片机开发了一个低功耗的手持数据采集器。图2概括了下位机硬件组成，系统包括ATMEL公司的内置8k Flash的AT89C52单片机、程序存储器(AT29C256)、数据存储器(选用了两片韩国高士达公司的76C8128)、实时时钟(NEC公司的uPD4991)、LCD显示模组(选用了新日电公司的模组)、KEYPAD接口(20个键)、IC卡接口(可读写ATMEL、Simens公司的各种加密IC卡)、光笔接口(能接解码、未解码光笔)、RS232C接口、电源分配及检测电路等。在硬件设计过程中关键解决了如下几个问题。

图2 下位机硬件组成(虚线代表各模块的供电回路)
　　1) 低功耗：为了获得低功耗特性采取了如下技术：第一，全部采用了CMOS的芯片；第二，充分利用了芯片提供的节电功能，最大限度地利用它们的维持(Standby)状态；第三、采用模块化供电，即根据工作需要接通相应功能模块的电源。例如，进行通信操作时，才给RS232接口接通电源，结束通信，立即切断电源；第四、充分利用单片机提供的闲置、掉电工作方式；第五、选用较低频率的晶振，经验表明，频率降低1MHz，单片机电流可以减少3mA。
　　2) 可靠性：采用两级供电，电源异常检测等措施。
　　3) 微型化：所有芯片都采用表面封装元件。
　　4) 友好性：采用点阵液晶显示器显示汉字界面，可同时显示8个16X16点阵的汉字；由于采用了软字库技术，故可以显示简、繁体汉字和特殊符号。
　　5) 可编程：为了方便程序修改和提供用户二次开发功能，系统采用Flash芯片(29C256)作为用户可编程程序存储器部分，核心程序部分放在单片机AT89C52中。
　　6) 可扩展：电路设计时预留了光笔接口模块，使数据采集器能满足基于条形码方面的数据采集。
5　结束语
　　本系统已在广东省东莞市几家独资企业正式投入运作。从运行效果来看，已达到最初的预期效果，劳资各方均感到比较满意，该区域巡逻监察系统对于管理人员来讲，可有效地帮助其监察下属员工执行巡逻任务的过程；对执行巡逻任务的下属而言，可如实记录其工作的全程，有利于反映其工作成果。另外，该系统不同于现场监控系统，现场监控系统利用摄象系统将员工的所有工作细节记录下来，有干涉员工隐私(privacy)之嫌，从人的社会性方面而言是不利的。前者为了获取可信的数据则是利用IC卡技术对工作过程中的某些关键点进行采样，事后进行分析处理因而没有干涉员工的私有性，所以从社会性角度看，也是没有多少弊端的。虽然该系统是在一独资制造企业开发成功并投入正常运行的，但由于该系统具有适用面广、价格低廉、可靠性高、使用方便等特点，无疑会在如下领域获得广泛应用：
　　1) 工业制造企业的厂区巡逻；
　　2) (码头、铁路等)货场的巡逻；
　　3) 物业管理公司的区域巡逻；学校及军事基地的区域巡逻，等等。
　　现实世界千变万化，一个产品要想完全满足各方用户的要求是非常困难的。为了进一步提高该系统的适用性，我们拟对该区域巡逻监察系统进行如下进一步的工作：首先，在上位机软件方面增加更为强有力的分析功能并利用GIS工具(如MAPINFO)实现区域分层化；其次，在硬件方面将进一步研制微型化的便携式数据采集器。
基金项目：国家自然科学基金青年基金（7980004）
作者简介：伍卫国（1964～），男，在职博士生，主要从事计算机控制、计算机网络方面的研究开发工作
作者单位：西安交通大学电信学院计算机系，西安710049
参考文献
1 黄种杰编著.管理学基础.北京：经济科学出版社，1996
2 周鸿伟.面向企业管理超媒体GIS开发平台的设计与实现.[硕士学位论文],西安：西安交通大学，1996
3 张育荣,曾彦贺编著.Delphi-从入门到精通.北京：清华大学出版社,1996
4 费培之编著.图和网络及其应用.成都：四川大学出版 ,1996
5 于红军,赵冬艳编著.智能(IC)卡技术全书.北京：电子工业出版社,1996
收稿日期：1999-01-11
