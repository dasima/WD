航空计测技术
Aviation　Metrology　&　Measurement　Technology
1999年 第19卷 第3期 Vol.19 No.3 1999



多通道智能场强计的研制
朱传焕
　　摘　要　介绍87C51单片机在研制多通道场强计中的应用情况以及软件和硬件的研究设计。
　　关键词　单片机　场强计　硬件　软件
Development of Multi-Channel Intelligence Field Intensity Meter
Zhu Chuanhuan
　　Abstract　The application of 87C51 single chip computer in developing multichannel intelligence field intensity meter,the research and design of software and hardware are introduced in this paper.
　　Key words　Single chip computer,Field intensity meter,Hardware,Software
　　随着现代科技与工业的发展，电子、电气设备或系统得到了越来越广泛的应用，电气设备所产生的干扰电平在不断地提高，电磁干扰对电磁环境造成越来越严重的污染，它们对电子、电气设备或系统以及人们的身体健康、生态环境构成威协。我们必须对这些干扰进行测试评估，以便采取措施进行有效地控制。近区场强仪是一种测量高电平近区电磁场的测量设备，它可测量各种漏场、寄生辐射，还可用于电磁兼容性实验。多通道智能近区场强仪不仅具有这些功能，它还可以多种方位实时地监测各种变化的电磁干扰。其测量范围为1～999 V／m，频率可达18 GHz，测量不确定度为1.5dB，通道数可达90个。
　　多通道智能近区场强仪将数据采集、处理、控制功能集于一体，它包括硬件和软件两大部分，其核心为87C51单片机。系统设计时，尽量用软件的办法解决，以减小硬件开支，降低成本。根据要求，将其设计为最小低功耗单片机应用系统。下面将硬件和软件部分设计分别进行论述。
1　硬件设计
　　硬件部分包括探头电路、平衡―不平衡转换电路、多路转换控制电路、放大电路、A／D转换电路以及87C51单片机。硬件设计原理框图如图1。

图1　硬件原理图
下面分别介绍各部分的设计情况：
1.1　探头电路
　　由小对称振子、检波管、高阻线组成，它将高频信号转换为直流信号，平衡输出。
1.2　平衡―不平衡转换电路
　　由于探头输出是平衡的对称方式，必须将它转换为不平衡方式，所以加上平衡―不平衡转换电路，它提供高输入阻抗，由低噪声低漂移精密运算放大器组成，如图2所示。


图2　平衡―不平衡电路
1.3　多路转换控制电路
　　由六片AD7506多路模拟电子开关组成，实现可达90路通道转换，其控制线由单片机87C51的P3口，经两片4～16线译码器译码后提供，如图3。


图3　多路转换控制电路
1.4　程控放大电路
　　程控放大电路将小信号进行10倍放大，以提高测量的灵敏度，将大于2 V的信号衰减10倍，由低噪声低漂移精密运算放大器和一个模拟电子开关组成，放大量由单片机87C51的P2口,P2.6和P2.7控制，如图4。


图4　程控放大电路
1.5　A／D转换电路
　　场强计的A／D转换对转换速度要求不高，只是要求精度高，输入电压范围大，所以选择MC14433芯片。MC14433是3位半A／D转换器，双积分型，转换精度高，为0.05％±1个字，功耗低，功能完整，片内有自动极性转换和自动调零功能，并提供有时钟发生电路，抗干扰能力强，易与单片机接口，转换速率为4～10次／s。
1.6　87C51单片机
　　为了减小功耗，采用低功耗的CHMOS器件，CPU选用87C51，液晶显示，最大静态电流控制在30 mA以内。
　　1)87C51单片机由87C51 CPU、晶振、八位液晶显示器组成，如图5。87C51 CP按其引脚功能分为三个部分：
　　a.I／O口线：P0、P1、P2、P3，共4个8位口。
　　b.控制口线：PSEN(片外取指控制)、ALE(地址锁存控制)、EA(片外储器选择)、RESET(复位控制)。
　　c.电源及时钟：Vcc、Vss、XTAL1、XTAL2。
　　2)87C51 CPU除了电源，复位和时钟外，其余管脚都是为了实现系统扩展而设置，它们构成了三总线结构，即：
　　a.地址总线(AB)：宽度16位，其外部存储器直接地址范围为64 K字节，16位地址总线由P0口经地址锁存器提供低八位地址(A0～A7)。P2口直接提供高8位地址A8～A15；
　　b.数据总线(DB)：宽度8位，由P0口提供；
　　c.控制总线(CB)：由部分P3口的第二功能状态和4根控制线PRST、EA、ALT、PSEN组成。
　　由于87C51是片内带EPROM的单片机，不带外部存储器扩展，将{EA}按高电平，P0、P1、P2、P3都可用作用户I／O口。
　　3)八位液晶显示器：由6片具有锁存功能的BCD―7段液晶显示译码／驱动器4056和八位液晶片及RC振荡器组成。显示通道数和场强值，如：“CH08：250.7”，即为第八通道，场强值为250.7 V／m。
1.7　A／D转换器与87C51单片机接口
　　虽然MC14433输出是动态分时BCD码输出，但由于87C51的P0口可作为用户I／O口，所以MC14433可直接接在87C51的P0口上。
2　软件设计
　　结合硬件线路，用汇编语言编程，自动交叉反汇编的方法得到机器码目标程序。采用自顶向下， 模块分割的设计方法， 同时考虑和硬件的配合问题， 作相应调整， 综合考虑， 权衡利弊， 调整到软、 硬件都能贯通为止。在编写软件时，需要借助于流程图，各功能模块的


图5　87C51单片机原理图
逐层分割，其实就是流程图由粗到细的过程。利用MC―51单片机进行在线仿真开发，把系统安置在实际环境中进行现场测试，分析查找测试中的问题及原因，根据问题，修改软件和硬件，直到设计符合需要。多通道智能场强仪监控程序原理框图如图6。


图6　监控程序原理图
　　根据总体结构，软件包括：
　　1)初始化准备程序：完成对87C51CPU的复位清零及初始化，进行P0、P1、P2、P3口状态设置。
　　2)多路开关控制程序：根据通道数设置多路开关数，完成通道的顺序转换。
3)量程控制程序：根据输入信号大小，自动地选择合适增益或衰减，完成对程控放大器的控制。
　　4)A／D转换程序：完成数据的采集。
　　5)数据处理程序包括：数字处理程序、检波特性修正程序、探头校准系数修正程序等。
　　a.数字处理程序：将存储在10H,11H,12H,13H,14H(存储放大或衰减倍数)单元的BCD码计算为一个数值,并将此数值存于20H,14H。
　　b.检波特性修正程序：根据20H和14H单元的数值采用曲线分段拟合法得到高频感应电压，数值存入21H,22H。将检波曲线分成四段，每一段采用直线拟合，直线方程为：Y＝aX＋b，Y为感应的高频电压，X为检波的直流电压，根据检波曲线，求得各段直线拟合方程如下： 
X：1～10 mV：Y＝0.2X＋0.62
　　10～50 mV：Y＝0.11X＋1.25
　　50～2000 mV：Y＝0.071X＋3.41
　　2000～8000 mV：Y＝0.134X－151.40

　
　　根据直线方程，编写程序得到Y。
　　c.探头校准系数修正程序：将21H和22H单元数值,利用查表或直线拟合方法得到场强数值E。
6)显示程序：显示通道数和对应通道场强值。
　　以上程序由于占用篇辐较大，程序清单不再列出。
　　软件和硬件仿真调试成功后，脱机运行，功能按设计要求运行，这样软件和硬件的设计基本成功。
3　场强计测量误差分析
　　1)关于A／D转换精度和分辨率的问题
　　a.A／D转换器的分辨率习惯上是以输出二进制位数或BCD码位数表示，与一般测量仪表(指针式)表达方式不同。对于MC14433芯片，分辨率按BCD码位数表示，为3位半，满度字为1999，用百分数表示其分辨率为[(1／1999)×100％＝0.05％]。A／D转换中，有一个量化误差的问题，它和分辨率是统一的，是由于有限数字对模拟数值进行离散取值(量化)而引起的误差。量化误差理论上为一个单位分辨率，提高分辨率可减少量化误差。
　　b.转换精度反映了一个实际A／D转换器在量化值上与一个理想A／D转换器进行模拟转换的差值，可表示成绝对精度和相对精度。这里，精度所对应的指标不包括量化误差。
　　c.MC14433实际转换精度为±0.05％\Ux\±1个字。对于三位半A／D来说,一个字误差相当于相对误差为：(0.05％)