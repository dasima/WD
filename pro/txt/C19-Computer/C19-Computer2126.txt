计算机工程
COMPUTER ENGINEERING
1999年 第25卷 第12期 vol.25 No.12 1999



视景音响模拟系统研究
谢　建　黄海滨　杜文正
　　怎样将现代高新技术成果应用于军事设备模拟训练系统的研制一直是研究军事训练方法的一大课题，视景音响模拟就是其中的方法之一，在大型设备的视景音响模拟中有很多实现技术和方法值得探讨。
1 系统的技术原理
　　视景音响模拟系统的硬件组成有2个方面的含义：对于系统的研制开发阶段，主要由计算机、MF－1868声卡、DC30 Plus 视频采集回放卡、录象机、扫描仪、扬声器、摄象机、Epson 7300投影设备等组成；对于研制成功后的系统，主要由计算机、MF－1868、扬声器、Epson 7300投影设备等组成。
　　如图1所示，音频数据的采集、压缩与处理在计算机控制下，通过MF－1868卡对录象机、麦克风输入的音频信号进行采集、压缩，通过DC30 Plus卡对录象机和摄象机输出的视频信号进行采集、压缩。对于静态图形图象，通过扫描仪将这些图形图象录入计算机，存入硬盘中，然后在编辑软件Adobe Photoshop V4.0中进行初步的编辑，以TIF文件格式压缩，存放在硬盘中。在设备工作过程中，包括了各种仪器设备的状态显示，其中有的是设备内部的状态显示，采用计算机动画的形式，通过动画模拟出这些状态的变化。





图1视景音响模拟系统原理示意图
　　软件制作是在计算机上对采集来的各种数据文件进行编辑。软件制作的操作平台是Adobe Premiere 4.0。制作完毕后的数据文件，即视频图象片段，以AVI格式存放。AVI格式的文件占用的存储空间非常巨大，在该系统中，仅仅是AVI文件就占用了近1.7GB的硬盘空间，由于模拟系统要代替实装进行长时间的使用，计算机硬盘就必须长时间工作，这对于硬盘的工作可靠性、寿命是很不利的。为了提高系统工作的可靠性和使用寿命，将AVI格式的文件用VideoPack V4.0 视频转换工具软件进行二次压缩，将其转换成MPEG格式，使原来的数据量减小为300MB，然后，将这些数据文件刻写在一张光盘上，避免了计算机硬盘工作时的频繁读取数据。同时，由于在MPEG格式的文件播放时是软件解压、播放，不需要价格昂贵的DC30 Plus 视频卡，因此，在提高系统可靠性、延长使用寿命的同时，还节约了经费。
　　当软件制作完毕后，在Windows 95环境中开发的应用程序的管理下播放出来。其中，音频信号由MF－1868驱动扬声器播放。视频信号的播放可以通过监视器或EPSON 7300 投影设备播放出来。
2 软件结构
　　软件的关键问题在于如何组织大量的图形、图象、声音、文字等多媒体数据，才能更好地实现操作模拟和人员培训的功能。围绕这一问题，该软件系统的层次结构可以分为3层：应用层、描述层和数据层。如图2所示。

图2软件系统的体系结构
2.1 数据层
　　该软件系统的数据层是指用于模拟操作现场环境的视景图象、声音及用于提高训练效果的辅助性文字、图形等多媒体数据的集合。数据层就像一个多媒体数据的仓库，它仅是存储数据，而不涉及数据的应用。数据层具有物理独立性和逻辑独立性。
　　数据的物理独立性是指多媒体数据的物理存储结构、存取方法与数据的逻辑定义分离，当数据的物理存储设备、物理存储结构和存取方法发生变化时，数据的逻辑结构和定义可以不改变，因此应用程序也可以不改变。
　　数据的逻辑独立性是指多媒体数据与多媒体应用程序的相互独立性。多媒体应用程序对多媒体数据的存储、检索等操作与数据的逻辑结构无关。数据改变后，应用程序可以不用修改仍然正常运行。数据的独立性不仅可以使数据被多个应用程序共享，而且对于提高应用程序的可靠性可可维护性有很大的好处。
2.2 描述层
　　描述层是对数据层的抽象，是对数据层中各种多媒体数据对象之间关系的全面描述。对于常规的格式化数据及数据间的相互关系可以用表和字段来描述。而对于非格式化的图形、图象、声音等多媒体数据，就要根据多媒体系统的特点来决定其描述方法。因为这些多媒体数据之间存在着自然的关联，包括时序关系(如多媒体对象在表达时必须保持时间上的同步性)和空间关联(如必须把相关媒体信息集成在一个合理布局的空间内的特性)。在建立对这些多媒体数据的描述时必须充分考虑它们的这些特点。
　　在该软件系统中，建立描述层的依据就是要模拟设备的操作规程。它不仅描述了操作过程中每一个工步的操作动作，还描述了各个工步应该对应的视景图象、声音、执行元件的工作状态等信息。
　　在软件的体系结构中，描述层是应用层与数据层之间的接口，为应用程序对多媒体数据进行操作提供了依据。在软件运行过程中，它所提供的描述信息是包含在软件的执行代码中的。
2.3 应用层
　　应用层是软件功能的实现者。它包括软件的各个功能模块和用户界面。软件的各个功能模块分别负责对外部模拟设备状态的检测与控制、依据描述层提供的信息对各种多媒体数据进行有机组合。用户界面有两个作用：一是为用户提供选择和设置操作程序的途径；二是将经过软件功能模块集成的多媒体信息展示在操作者面前。
3 视景模拟中的几个问题
3.1 设备的全视景与辅助说明的叠加
　　在设备操作的素材中，有从扫描仪来的静态图象，有从DC30 Plus来的视频图象，也有通过计算机动画制作而成的动画。其中，操作的主线由视频图象来表现，它贯穿于该项操作的始终。但是，仅仅以活动视频图象来表现整个视景内容是不够的。为了解决这个问题，用静态图形模拟某些设备内部视场状态，同时，用闪烁的光标和文字符号以"在线帮助"的形式提示操作手。在播放操作动作、过程的同时，将某些仪器的内部视场与活动画面在计算机屏幕上同屏显示出来。有的重点、难点内容和操作手容易出现失误的地方，我们都用文字、符号、光标闪烁、不同的颜色等手段进行了强调和说明。
　　对于用计算机生成的图形图象、动画、文字等辅助说明内容，通过软件中同步进程控制模块，检索相应视频帧的位置，将其叠加在表示设备全视景的视频画面中相应位置。如图3所示。

图3帧计数同步控制方法实现面板状态更新和辅助说明的叠加
　　对于用机构细节的视频画面表示的辅助说明，画面以同一背景下的该设备全景为主，利用Adobe Premiere 4.2的过渡功能(Transitions)，在进行图象片段的编辑时，就将辅助说明叠加在全视景画面上，使整个设备的动作与局部动作同时展现在用户面前。
3.2 多媒体事件进程同步控制
　　在设备的视景模拟过程中，以下两类多媒体事件应保持同步：设备运动机构到位(一个工步结束)与操作面板状态发生相应变化之间应同步进行；用文字、图形图象、动画等表示的辅助说明与设备全视景画面相应帧之间应同步出现。这两类事件的同步由软件的进程控制模块保证。为了在一个工步结束、下一工步开始时准确同步地更新面板显示状态，采用了帧计数同步法。在编辑好的视频图象片段中，每一幅画面都有相应的帧号fi ，根据实际操作过程中，设备实际状态与操作面板状态、设备全视景与需要进行辅助说明的内容之间的对应关系，确定视频图象片段中的特征帧S (帧代号)，当程序的同步进程控制模块计数到fi =S时，特征帧S触发同步进程控制模块，同步更新面板状态或者向全视景画面叠加辅助说明。示意图如图3所示。
4 音响模拟中的几个问题
4.1 循环式音响模拟
　　在该设备工作过程中，现场音响主要包括柴油发电机组和电动机的声音。柴油发电机组正常运行时声音比较单一，而且其持续时间取决于操作手的操作，其运转与否具有相对独立性。若将从柴油机启动到操作结束的全过程声音采集在一个文件里，不仅会占据大量的硬盘空间，也不能满足人机交互时音响模拟的实时性要求。为此，将柴油机启动、正常工作、停止运转的声音分别采集成3个单独的文件，其中柴油机正常工作的声音文件只是柴油机正常工作时的一个很短的声音片段。当系统检测到柴油机启动信号时，先播放机组启动的声音文件，然后循环播放机组正常工作的声音文件。当检测到柴油机停止运转时，先停止循环播放，再播放机组停止运转的声音文件。
4.2 多个音响进程的模拟
　　在操作过程中，限动器等执行机构动作时需启动电动机。而且由于其随机性，不可能预先将此声音编辑进柴油机正常工作的声音中，而必须采用独立的声音叠加进去，但是Windows的多媒体声音设备在同一时刻只能播放一个声音文件，为了在不中断柴油机声音的条件下使系统能发出电动机启动的声音，制作了一个模仿电动机声音的MIDI文件，当某一工步启动电动机时便播放该文件，这样系统便能够同时发出柴油机运转和电机启动的声音。多音响进程的控制如图4所示。

图4音响模拟中的同步进程控制
5 结论
　　该系统采用先进的视景音响模拟技术，对设备的工作过程进行模拟，克服了实装训练中的不足，为设备的训练和教学提供了一种科学、合理的手段。开发的应用软件人机界面良好，工作可靠，能够很好地对实现操作面板检测、视景音响回放控制、多进程同步控制与人机交互的需要，并具有良好的可维护性。
作者单位：第二炮兵工程学院，西安710025
参考文献
1 Steinmetz R,Nahrstedt K. Multimedia: Computing, Communica- tion and Application. Beijing: Tsinghua University Press，1997
2 Adobe Premiere User Guide. Adobe Systems Incorporated 1994-06
3 刘甘娜. IBM－PC微机原理及接口技术. 西安：西安交通大学出 版社，1993-064 杨学良. 多媒体计算机技术及其应用. 北京：电子工业出版社 1996-03
