计算机应用研究
APPLICATION RESEARCH OF COMPUTERS
2000　Vol.17　No.2　P.93-94,101



生产信息实时发布系统
张伟　彭民德　黄炜
摘 要 Network 90分布式过程控制系统是Elsag-Bailey集团80年代推出的产品，在我国许多企业的生产过程自动控制中有着广泛的应用。但受产品生产年代的制约，N90上运行的许多管理软件，已不能适应今天企业发展的需要。生产信息实时发布系统将原N90系统中的MCS仿真软件移植到Windows 95环境下的网络工作站上，有效地解决了这一问题。详细地阐述了生产信息实时发布系统的功能及结构。
关键词 过程控制 分布式 实时 生产信息
0 前言
　　Network 90(以下简称N90)分布式过程控制系统，是Elsag-Bailey集团80年代推出的产品，该系统性能先进、适用范围广，在我国众多企业的工业过程自动化控制中，有着广泛的应用。因当时计算机发展情况的制约，多数软件已不能适应今天企业对生产过程控制管理的自动化需要，对于广大用户而言，开发基于N90的新一代管理控制软件势在必行。生产信息实时发布系统是基于N90开发的、对原N90管理控制系统(MCS)软件的仿真。此系统运行在管理局域网络的工作站上，通过计算机接口单元(CIU)，与N90环路网络通信，从而取得实时生产信息，经分析处理后，在管理工作站上再现生产过程仿真画面。
1 N90系统结构
1.1 N90系统体系结构
　　硬件体系结构如图1所示。N90系统由若干个环形通讯网络组成，在每个环行网络上，可挂接多个过程控制单元(PCU)，多功能处理器(MPU)、过程控制观察站(PCV)、操作员接口站(OIS)、计算机接口单元(CIU)、工程师工作站(EWS)等组件。其中MFP是PCU的核心组件，它通过相关接口与现场设备传感器相连，接收和处理现场生产信息。在N90中，每个信息采样点都用一个整数－标签来标识。生产信息在环形网络的控制下，合理地在系统的各个组件之间流动。PCV、OIS、EWS上运行N90配套的系列软件，用来完成对整个系统配置、监控、管理等任务。CIU是N90为了增强其开放性而增加的与第三方产品的接口设备。第三方产品可通过CIU及N90规定的标准协议与N90环路通信，达到控制、管理的目的。

图1　系统结构示意图
1.2 环路通信协议及其专用技术
　　N90系统采用存储器插入式的存储转发协议，网络中没有通讯指挥器，所有节点的地位是平等的，没有主次之分。每一节点随时独立地进行数据接收、数据发送以及数据删除功能，通过传输介质与相邻的两个节点相连，最后形成一个闭合的回路。数据信息在网络节点间依次传递，从信源节点到目的节点，再由目的节点到发出信息的节点上。
　　为了防止通讯通道的阻塞，保证通讯传输的通畅，提高网络通讯效率，N90系统采用两种有效的通讯技术，即例外报告技术和信息打包技术。
　　(1)例外报告技术
　　例外报告技术就是在过程控制中产生的涉及测量、操作、报警、管理的信息，经过一定的技术处理后，形成一种反映信息值的专门报告。这一报告的显著特点是只反映某一时间间隔内发生显著变化的信息，而对没有发生显著变化的信息，不产生报告。
　　(2)信息打包技术
　　在N90环路中，信息的传输格式规定为两帧式。其中第一帧为标题帧，第二帧为信息帧，并且两帧之间有一定的间隔。打包技术就是将去同一地址的所有信息压缩在一起，使用一个标题帧，再把信息发送出去的专有技术。
2 生产信息实时发布系统的设计及实现
　　生产信息实时发布系统根据原MCS系统的特点，在运行Windows 95的网络工作站上进行了二次开发，在保存了原MCS系统功能的同时，采用了OpenGL图形处理技术，配置了图形加速卡和大屏幕终端，所以图形显示速度快，画面显示清晰。在人机交互方面，将原系统中大部分由键盘完成的工作，交由鼠标控制下完成，使用户在较少的击键情况下能完成更多的工作。所以系统功能更强，使用更方便。
　　根据N90的MCS系统仿真监控的要求，系统结构设计如下：为了能从环路中获得信息，并进行仿真控制，首先在被监控N90环路上增加一个CIU模件及一个端子模件，管理局域网络上的前端数据采集工作站通过串行口以RS232协议与环路相连，完成数据采集工作。数据从环路中接收后，分析处理，写入网络服务器中的数据库。运行在管理局域网络上的多个MCS仿真工作站从数据库中获取数据，完成仿真任务。这样就形成了以网络数据库为服务器，以数据采集和MCS仿真为客户机的Client/Server体系结构。其硬件互连结构如图1所示，软件结构如图2所示。

图2　系统软件结构示意图
　　根据以上分析，整个系统由三部分组成：中央网络数据库、N90环路接口数据采集软件、MCS仿真软件。
2.1 中央网络数据库
　　网络数据库用来存放从N90环路中取得的生产实时信息。为了处理上的统一，N90将环路中的各种信息归纳为23种数据类型。这23种数据类型，是设计数据库结构的重要依据。数据库的属性，一方面要能正确表示这23种数据类型，达到存放环路数据的目的，另一方面，还要包括环路号、标签号等信息，从而完成数据的定位和标识工作。
2.2 N90环路接口软件
　　N90环路接口软件的主要任务是通过CIU从环路中获得生产实时信息。当接口软件开始工作时，首先要判断是否是第一次运行，如是第一次运行，则要创建数据库并完成初始化工作，然后，初始化CIU，通知环路建立信息采集点即标签点表，随后向环路发送例外报告读取命令，接收回响后，分析处理，并写入数据库。接口软件流程如图3所示。

图3　接口软件流程图
　　其主要工作由以下几个方面组成。
　　(1)数据库的初始化。环路接口软件运行时涉及到从环路中采集哪些标签数据的问题。在N90系统中，MCS的仿真画面，是由工程师根据生产过程的实际需要用线性编辑生成器(LEDG)编辑虚拟设备介质文件(VDM)描述的。每个过程的仿真也即每个VDM文件都与若干个标签相关联。通过对系统中所有VDM文件的分析，我们可获得整个系统所需的标签。在对VDM文件分析的过程中，每获得一个所需要的标签，就向数据库中插入一个记录，并使数据库中的记录和系统所需标签呈一一对应关系。此项任务在接口软件第一次运行时完成。
　　(2)实时信息的采集。系统提供60多种命令与原有命令兼容，允许前端工作站通过CIU以RS232协议与环路通信。命令可分为三类：①环路初始化、标签点表的建立等通信服务建立命令。②数据采集命令，如例外报告的读取、报警故障信息的读取等命令。③N90系统配置命令。
　　接口软件通过串行口、CIU向N90环路发布相应命令，异步接收回响后，分析处理，再写入数据库。另外，接口软件还要处理通信过程中的差错、超时等异常情况。
　　(3)接收信息的分析处理。N90环路中发到前端机的例外数据包，每包中可能包含多个标签的例外数据，因此必须首先以标签为依据，进行分割。另外，对于每个标签的数据，可能又包含多个数据信息，因此，必须根据此标签所对应的数据类型，将此标签所对应的数据分解为多个字段。这些字段有的可能又被N90压缩了。N90可根据实际情况将其压缩成2字节或3字节或4字节。对于此类数据，必须解压处理。以上处理过程完成后，才能将此标签对应的数据写入数据库的相应字段中。
2.3 MCS仿真软件
　　MCS仿真软件运行在管理网络的MCS仿真工作站上，其主要任务是根据LEDG仿真过程画面生成软件所生成的仿真画面描述文件即VDM文件的内容，从数据库中获得相应标签数据，对生产过程进行实时仿真。除以上主要工作外，仿真软件还要响应键盘及鼠标消息，完成人机交互功能。主要流程如图4所示。

图4　MCS仿真软件主流程图
　　其具体任务如下。
　　(1)绘图命令处理。为了对生产过程进行有效仿真，N90系统提供了大量的绘图命令，用来描述反映生产过程的实时画面。仿真系统一个重要的工作就是处理这些绘图命令，绘图命令处理正确与否，是仿真系统实现成败的关键。这些绘图命令可分为两大类。
　　1)静态绘图命令。这些命令主要用来绘制一些简单的图元，如画折线命令(pl)、画圆命令(cc)、画弧段命令(ac)、文本显示命令(tx)等。这些命令不会与生产过程中的实时数据即标签数据相关连。
　　2)动态绘图命令。MCS仿真系统用动态绘图命令实现对生产过程状态的动态追踪功能。如泵的启停，管道的压力，报警信息、趋势信息等的动态实时描述。为了让动态绘图命令能完成以上功能，动态命令一般都与标签数据相联系，即标签作为动态绘图命令的一个参数。动态绘图命令被解释处理之前，必须根据其所提供的标签索引，从库中检索出实时数据，然后再依据此数据绘制相应的图形。动态图形命令可分为如下几类：动态报警命令(ea)、动态配置命令(ec)、动态交互命令(ei)、报警摘要命令(as)、趋势命令(et)、动态程序命令(ep)、动态符号命令(ed)。
　动态绘图命令一方面涉及系统过程中动态数据，所以会与标签相关连。另一方面还要完成某些静态图形命令所完成的功能，如字符的显示、字符特征的设置、图形符号着色等功能，所以它又有静态绘图命令的特点。
　　(2)MCS仿真过程所需数据获取。MCS仿真系统要不停地根据生产过程中的实时数据动态地调整仿真画面。其所需的实时数据，是仿真系统从网络数据库中获得的。
3 结束语
　　生产信息实时发布系统在运行Windows 95操作系统的网络工作站上实现原N90系统中的MCS仿真系统的功能，有效地克服了原仿真系统的缺点，使N90系统在新的市场环境下更能适应企业对生产过程的控制、管理和决策的需要。这对于我国广大N90用户而言，具有一定的实际意义。
张伟（长沙铁道学院计算机系 长沙 410075）
彭民德（长沙铁道学院计算机系 长沙 410075）
黄炜（长沙铁道学院计算机系 长沙 410075）
参考文献
1，Bailey GRP.Network90 Management Command System Operation/Configuration Manual Software Release L.2.Product Instruction E93-901-21
2，Bailey GRP.Network90 Enhanced Computer Interface Unit Programmer's Reference Manual. Product Instruction E93-905-9
3，张 伟等. INFI90分布式过程控制系统. 长沙铁道学院学报, 1999(2):40～44
收稿日期：1999年7月14日
