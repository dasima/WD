计算机应用研究
APPLICATION RESEARCH OF COMPUTERS
2000　Vol.17　No.2　P.51-52,62



数据安全及双机容错解决方案
陆郁梅
摘 要 随着近年来网络系统的普及和应用，人们日益认识到企业中最宝贵的不是各种网络硬件，而是网络中存储的用金钱也难以买到的业务数据。如果无法保证网络数据的安全，那么对网络的大量投资就失去了意义，并结合了实际应用讨论了容错技术及在NT、NOVELL环境下双机容错的解决方案。
关键词 容错 数据恢复 Lifekeeper LEC-3808
　　近年来，计算机和网络技术的普及大大提高了企业的工作效率，但同时也带来了一些负面影响，其中最值得我们关注的就是系统失效问题。
　　造成计算机系统失效的因素归纳起来可分为两类：一类是自然灾害(包括人为破坏)；另一类是系统缺陷，即计算机系统自身的不可靠因素，如：误操作、软件缺陷、硬件老化、病毒等。
　　在计算机系统中最宝贵的财富是系统中的业务数据。由于企业越来越依赖于计算机处理业务，系统失效将会是一场大灾难。如果出现故障，企业将无法正常经营，甚至陷入瘫痪，这时，企业最关注的问题就在于如何尽快恢复计算机系统，使其能够正常运行。
1 故障分类
1.1 物理故障
　　物理故障是指造成系统无法正常运行的软硬件损坏。这些故障通常会导致逻辑故障，如硬盘故障可能会导致数据丢失，网络故障可能会破坏数据一致性等。
　　常见的物理故障包括：
　　●操作系统故障：非法指令造成的系统崩溃，系统文件被破坏导致无法启动操作系统等。
　　●应用程序损坏：缺少文件或程序本身不完善导致程序无法运行。
　　●整机损坏：由掉电、火灾、地震等造成设备无法运行。
　　●硬盘故障：硬盘系精密设备，安装时的无意磕碰、掉电、电流突然波动等原因都有可能造成硬盘损坏。
　　●网络设备故障：传输距离过长、设备添加与移动、传输介质的质量问题和老化都有可能造成网络故障。
1.2 逻辑故障
　　逻辑故障包括两种：第一种是系统虽然能够正常运行，但实际已经有部分损坏，如数据文件丢失、程序丢失等；第二种是系统本身虽然完好无损，可是系统中的部分数据是错误的，这类故障的隐蔽性很强，通常难以发现，更难以修复。
　　常见的逻辑故障包括：
　　●数据不完整：系统缺少完成业务所必需的数据。
　　●数据不一致：系统数据是完全的，但逻辑关系不正确。
　　●数据错误：系统数据是完全的，也符合逻辑关系，但数据是错误的，与实际不符。
　　●逻辑故障隐蔽性强，往往带有巨大的破坏性，是造成损失的主要原因。根据有关统计，恢复10MB(约2,500页纸)的数据最少也要花费近20天时间，成本在万元以上。目前服务器硬盘容量平均为4GB，我们不难算出恢复服务器数据的开支十分惊人。
2 网络备份及数据恢复
　　企业拥有好的备份系统和备份方案，可以将灾难的损失减小到最低程度。一般地，在硬件一级有磁盘镜像、磁盘阵列、双机容错等备份方案；在软件一级有热修复、数据拷贝等措施。
　　备份的方法主要可以分为三类：硬件级、软件级和人工级。
　　硬件级的备份是指用多余的硬件来保证系统的连续运行，比如硬盘双工、双机容错等，如果某个硬件损坏，后备硬件马上能够接替其工作。但这种方式无法防止逻辑上的错误，如人为误操作、病毒、数据错误等。据有关资料统计，计算机系统中80%以上的错误属于人为误操作。当逻辑错误发生时，硬件备份只会将错误复制一遍，无法真正保护数据。硬件备份的作用实际上是保证系统在出现故障时能够连续运行，因此称为硬件容错更为恰当。
　　软件级的备份是指将系统数据保存到其它介质上，当系统出错时可以将系统恢复到备份时的状态。由于这种备份是由软件来完成的，所以称为软件备份。用这种方法进行备份和恢复数据都要花费一定的时间，但可以完全防止逻辑错误，因为备份介质和计算机系统是分开的，错误不会复写到介质上。这意味着，只要保存时间足够长的历史数据，就能够恢复正确的数据。
　　人工级的备份最为原始，也最简单，因为如果所有数据都有文字记录，显然可以恢复数据，但耗费的时间恐怕相当长。因此全部数据都用手工方式备份是不可取的。
　　理想的备份系统是软件备份和手工方式相结合。如果系统出错，备份之前的数据用软件方法恢复，备份之后的数据用手工方式恢复。采用这种结合方式，不仅能够有效地防止逻辑错误，还能够节省备份和恢复时间。如果在备份系统的基础上再加上硬件容错系统，那就会更加安全可靠。
　　可以说网络备份实际上不仅是网络上各计算机的文件备份，实际上还包含了整个网络系统的一套备份体系。
3 双机容错及解决方案
　　双机容错：可以防止单台计算机的物理故障，当一台计算机出现故障时，系统仍然可以工作。双机容错方案分为纯软件的解决方案和软件与硬件结合的解决方案，本方案提供的是一种完整的解决方案，也可以只保留软件来实现容错。
　　现将NT，Novell平台双机容错解决方案介绍如下，该解决方案在证券及金融行业得到广泛应用，并取得了良好的使用效果。
3.1 NT平台下Lifekeeper解决方案
　　LifeKeeper For Windows NT软件是NCR公司推出的全球第一套基于NT操作系统，并支持16台服务器的容错软件。该系统可有效避免由于证券商交易服务器宕机造成的业务中断、数据丢失等重大损失，保证交易平台系统级的在线热切换，有效维护用户的商业信誉。
　　LifeKeeper For Windows NT提供了一个完全容错的软件解决方案，它不需要任何自定义的容错硬件，服务器可以是任何基于Intel架构的平台。用户可以集合使用2到16个NT节点。在出现故障的情况下，LifeKeeper会将被保护资源自动转换到一个根据优先权设定的系统。用户在实际进行切换时，会经历一个十分短暂的休眠，但是，当系统完成切换操作后，LifeKeeper会在所选择的系统上自动地恢复操作。LifeKeeper For Windows NT支持共享磁盘阵列柜和非共享磁盘阵列柜两种实现方式，从而给不同选择、不同需求的用户提供了多种选择。
　　(1)软，硬件配置
　　1)两台服务器，每台服务器有一块网卡，一块本地硬盘，一个外接SCSI接口。
　　2)一台磁盘阵列，相应容量阵列硬盘。
　　3)NCR公司LifeKeeper容错软件包。
　　(2)硬件连接及软件安装
　　将磁盘阵列通过SCSI接口分别与两台服务器相连，两台服务器网卡接到一个HUB上，在本地硬盘上装NT操作系统，数据库引擎，容错软件包。在磁盘阵列上装数据。
　　(3)工作原理
　　正常时，一台服务器做主机工作，另一台做备机等待，当主机出故障时，备机在20秒内，通过网链及SCSI链自动侦测出，然后开始接管Server IP，重启数据库进程，接管磁盘阵列上的数据库数据。整个过程在一分钟左右完成。当主机恢复后，自动作为备机，也可手工切回。
　　(4)Windows-NT平台 双机容错软件包
　　1)NCR公司Lifekeeper双机容错软件包核心(包括SQL Server的Recover Kit工具)用于Windows-NT操作系统平台(每台主机各配备一套，支持Client/Server结构)。
　　2)工作方式：
　　Active and standby model(主机工作，备机在线热备，故障时自动侦测切换，原故障主机修复后自动作为在线备机)。
　　Active and Active(两台服务器各自承担自己的任务，当其中一台故障时，另一台自动接管故障机的用户，数据及进程，当故障机恢复后，自动切回)。
3.2 Novell平台
　　(1)软、硬件配置
　　1)两台服务器，每台服务器有二块网卡，一块本地硬盘，一个外接SCSI接口。
　　2)一台磁盘阵列，相应容量阵列硬盘。
　　3)Vinca公司Standby for NetWare容错软件包。
　　(2)硬件连接及软件安装
　　将磁盘阵列通过SCSI接口分别与两台服务器相连，两台服务器各选一块网卡接到一个HUB上，作数据传输，另一块网卡交叉互接，作侦测；在本地硬盘上装NetWare操作系统，容错软件包。在磁盘阵列上建SYS卷及DATA卷。
　　(3)工作原理
　　正常时，一台服务器做主机管理磁盘阵列上的SYS卷及DATA卷，另一台做备机等待，当主机故障时，备机通过侦测网链自动侦测出，然后开始接管磁盘阵列上的SYS卷及DATA卷。整个过程在一分钟左右完成。当主机恢复后，自动作为备机，也可手工切回。
　　(4)Standby for NetWare双机容错软件包
　　NETWARE平台双机容错软件包：
　　1)双机容错切换软件包：用于NETWARE操作系统平台。
　　2)工作方式：
　　Hot-standby model：(主机工作，备机在线热备，故障时自动侦测切换，原故障主机修复后在备机上的任务将自动重新交回，原备机继续作为在线备机)。
　　特点：原主机修复后将自动重新回切，适合于主机功能配置高于备机的情形。
3.3 硬件配置：LEC-3808双机智能容错磁盘阵列
　　●LEC-3808 Disk Array Subsystem(容错磁盘阵列系统)
　　●One Intelligent System Controller(智能系统控制器)
　　●One ASIC SCSI Controller Chip Set(SCSI专用控制组)
　　●16 MB Rewrite/Read Cache(16 MB读写缓存)
　　●2 Wide-SCSI Host Channel(两个主机接口)
　　●1 Internal Ultra SCSI Disk Channels(1个内部快速硬盘通道支持7个阵列盘)
　　●7 SCSI Harddisk CRU(7个热插拔硬盘槽位)
　　●RAID 0-5 Support(RAID磁盘校验：0-5，通过美国RAB测试)
　　●Hot-Swap Support(故障硬盘数据在线自动恢复，硬盘热替换)
　　●Redunant Hot-Swap Power Supply /Fan*2(双热插拔电源、双风扇)
　　●LCD Display Panel(前面板LCD液晶显示屏)
　　●SCSI-II Cable*2(SCSI电缆，用于磁盘阵列与主机连接)
　　●Active Termintor(SCSI总线终结器)
　　●Deskside Cabinet(桌边式机箱)
　　●SCSI Harddisk硬盘容量可根据容量要求选配各种型号的Ultra-Wide SCSI接口的1GB/2GB/4GB/9GB SCSI单元硬盘及其数量，LEC-3808容错磁盘阵列已提供七个热插拔硬盘盒。
　　SCSI硬盘配置参考：接口标准：Ultra-Wide SCSI，68pin，7200rpm。
陆郁梅（中国科技大学研究生院 中国人民大学 北京 100020）
参考文献
1，(美)拉拉(Lala,P.K.). 容错与故障可测性系统设计
2，袁由光, 陈以农. 容错与避错技术及其应用. 1992
3，闻新. 控制系统的故障诊断和容错控制. 1998
收稿日期：1999年7月31日
