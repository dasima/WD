计算机研究与发展
JOURNAL OF COMPUTER RESEARCH AND DEVELOPMENT
1999年　第36卷　第10期　Vol.36　No.10　1999



一个基于图基的参数化设计方法
金建国　谭建荣　董玉德
　　摘　要　文中提出一个基于图基高层次图素的产品参数化设计方法，对图基及图基骨架的概念和定义作了阐述，讨论了图基的性质及其分类，提出了一系列图基构造算子，给出了一个基于图基骨架自组织的算法和信息模型，得出了一个利用尺寸约束树把不同图基线素之间的尺寸约束向其中某一图基内部尺寸约束的转换方法，并在此基础上给出 一个基于图基的参数化设计算法.应用此方法摆脱了传统基于几何拓扑低层次线素繁琐的交互设计工作.
　　关键词　图基，骨架，自组织，构造算子，尺寸约束
　　中图法分类号　TP302；TH122
A PARAMETRIC DESIGN METHOD FOR GRAPH-BASIS
BASED PRODUCT MODELING 
JIN Jian-Guo, TAN Jian-Rong, and DONG Yu-De
(State Key Laboratory of CAD & CG, Zhejiang University, Hangzhou 310027)
　　Abstract　Here presented is a new approach to parametric design for graph-basis-based product modeling. The concept and definition of graph-basis and skeleton are described. The classes of graph-basis and their proposition are discussed. A series of graph-basis construct operators, an information model, and an algorithm which is based on the graph-basis self-organization are proposed. A method is also proposed, which can turn the dimension constraints between two different graph-basis inner elements into one of the graph-basis inner elements dimension constraints. On this basis, a parametric design algorithm is obtained. By using this approach, the product can be designed effectively. 
　　Key words　graph-basis, skeleton, self-organization, construct-operators, dimension-constraint
1　引言
　　传统的二维图纸参数化设计都是基于点、线、圆、圆弧的.而本文提出的基于图基的产品零件参数化设计方法是在更高层次图素上的设计工作.作为产品信息设计和表达语言的图基，无论在概念设计，结构设计还是在详细设计中，设计人员都能用直接反映自己设计意图的图基及对图基的操作来形成完整的产品描述，摆脱了传统基于几何拓扑低层次线素繁琐的交互设计工作.
　　目前，基于传统点、线、圆、圆弧的参数化设计方法主要有以下几种：变动几何法［1］、几何推理法［2］、参数化操作法［3］和符号代数法［4］.还有一些学者［5，6］把遗传算法、退火算法及动力学分析和随机过程等方法也应用到参数化工作中来，参数化设计技术得到了蓬勃的发展.
　　本文提出一种基于图基自组织及图基构造算子的参数化设计方法，整个零件图由一系列实例图基自组织生成，而每一实例图基又由实例图基构造算子序列组成.这为零件图的参数化提供了简便、有效、便利的手段.采用这种方法的思想基础是① 我们常用的零件工程图都是由尺规依序作图的，一般不存在循环约束的问题；② 零件图分解为一系列有序图基的自组织与图基由一系列有序构造算子组成的思想与参数化的本质是约束的分解和有序化相吻合.
2　图基的概念
　　定义1. 图基.图基是指具有一定功能的结构单元.它根据产品零件的拓扑特征、形状特征、尺寸特征等,将描述同一特征的点、线、面等图素加以组合而成；它是工程技术人员思考、创造的工程语言，也是设计、制造和加工的基本单元.
　　定义2. 图基的局部标架和线标架.用于定义整个图基实例的各个线素坐标的坐标系，我们称之为图基的局部标架.附着于图基边界线素上的坐标系，我们称之为线标架.图基上一般应建立两个（或两个以上的）基本线标架，不妨称之为左线标架和右线标架（若有多于两个的线标架，则其余的不妨称之为上线标架，下线标架 …），这主要根据图基的类别和图基的具体情况而定.线标架以边界线上一点为坐标原点（该坐标原点的取法是有一定规则可循的，一般同类图基取法规则是相似的，如轴类图基取其中心线和图基边界线的交点，即此边界线的中点.），以该点所在的边界线切矢为y轴，且x轴和y轴构成右手坐标系.左线标架和右线标架的y轴矢量应在图基边界线上构成逆时针圈（因为这些线标架是可由边界线素确定的，所以在图基里是隐含表示的.不过我们在图基对应的图标里是显式标记出来的，以方便设计者利用图基进行零件的初始设计，因此对每一个图基来说，图基的线标架位置是完全确定的）.
　　定义3. 图基的骨架.由图基的外轮廓线素及附着于图基上的局部标架和线标架组成.图基的骨架是实现图基之间自组织的主要信息来源.
　　定义4. 线标架的斜叠、反叠和叠合：
　　① 若线标架L1和L2的原点重合，而x轴成任意角度，则我们称L1和L2斜叠；
　　② 若线标架L1和L2的原点重合，而x轴和y轴分别反向，则我们称L1和L2反叠；
　　③ 若线标架L1和L2的原点，x轴、y轴分别互相重合，则我们称L1和L2叠合.
　　定义5. 称属于不同实例图基的两线素是尺寸约束等价的，如果这两个线素是两图基自组织时的重合定位线素.例如，图1中实例图基A的线素L和B的线素M是尺寸约束等价的.


图　1
3　图基的分类与性质
　　按各种不同的功能要求对图基(graphics basis)进行分类，图基一般可分为以下几类：
　　① 轴类图基；② 齿轮类图基；③ 箱体类图基；④ 叉架类图基；⑤ 套盖类图基；⑥ 薄板类图基；⑦ 标准件图基；⑧ 简单图基；⑨ 常用结构图基；⑩基本线素图基如点、线、圆等.图基具有以下几种性质：
　　(1) 图基是参数化设计中的一个基本单元.应用图基，不仅可以进行拓扑结构不变，尺寸可修改的变量驱动的参数化设计，而且可以进行改变结构的动态设计.图基的自组织算法为图基参数化的一致联动打下了基础；
　　(2) 图基的自定义性.图基的形状、结构可以扩展.设计者可通过对已有图基的调用和自定义来扩展图基库；
　　(3) 图基的黑箱性.图基之间的相互作用可以不考虑图基的内部细节，而只考虑其骨架；
　　(4) 图基的LOD(level of detail) 性 .图基具有层次性，可以层层递归分解；
　　(5) 图基的生物性.图基的生命历程包括产生、继承、变异、派生、映射和消亡.
4　图基的构造
　　考察图基的构形，我们归纳出如下几类基本的图基构造算子：
　　(1) 基本线素算子
　　用以创建点(给定坐标点)、线段（给定线段长度尺寸及线段与正x轴夹角）、圆（给定圆心坐标、半径尺寸）、圆弧（给定圆心坐标、半径尺寸和始末端点与圆心连线与正x轴夹角）等基本作图元素.如图2所示.


图2　基本线素类构造算子
　　(2) 分割算子
　　是对线段（给定分割比）、圆（给定分割点与圆心连线和正x轴方向夹角）、圆弧（给定分割点与圆心连线和正x轴方向夹角）等作图元素的分割.如图3所示.


图3　分割算子
　　(3) 线标架算子
　　用以在图基轮廓线上创建线标架(参见图4).包括线段、圆、圆弧上线标架的创建，创建方法见定义2.


图4　线标架算子
　　(4) 镜象算子
　　给定对称距离尺寸(如“已知直线”和对称轴的距离，“已知圆和圆弧”的圆心到对称轴的距离)从已知线素和对称轴求对称线素，如图5.


图5　镜象算子
　　(5) 切算子
　　用以从已知线段（或圆、圆弧）求和其相切的圆、圆弧（或线段）.如图6左，需给定圆（或圆弧）的半径尺寸，从而由圆（或圆弧）和已知线段的端点相切确定该圆（或圆弧）的圆心坐标.如图6右，需给定线段的长度尺寸，从而由线段和已知圆弧在一端点相切，确定该线段的另一端点.


图6　切算子
　　(6) 过渡线算子
　　包括同侧过渡线算子和异侧过渡线算子，用以从已知的两线素获得其公切线素段.如图7（上），对于已知半径尺寸和圆心坐标的两已知圆，可以唯一确定它们的内、外公切线段.


图7　过渡线算子
　　(7) 连接算子
　　包括①两已知直线段和一圆弧段相交（见图8左，给定圆弧段的半径尺寸r，从和两已知平行直线段距离相等的公分线和以已知线段的一个端点作半径为r的辅助圆的交点即可获得该圆弧段的圆心）；②给定两点，求连接两点的直线段(见图8右)等.


图8　连接算子
　　(8)　分叉算子
　　用以从已知线段L和其端点P，获得过P点的两分叉线段.此两分叉线段由长度尺寸和线段与x轴正方向的夹角确定，如图9.


图9　分叉算子
　　(9) 交平算子
　　用以①从已知线段和已知夹角尺寸α，求另一交线段d及②已知线段m，求另一和其相距为d的直线的过程，如图10.


图10　交平算子
　　(10) 定位算子
　　用以对给定的多边形环，按一定法则给出多边形内的定位点P，如图11.


图11　定位算子
　　(11) 其它算子
　　包括圆圆相离和线圆相离等算子（其它算子不再列举）.见图12.


图12　其它算子
　　利用上述构造算子可以方便地构造各种图基.并且由于构造的有序性，以及改变一个尺寸相当于改变对应构造算子的一个参数值，所以能很方便地对图基实行参数化.例如，对图13几何图形（图基），可用构造算子序列描述如下：


图13　图基构造例子
　　get_circle(P0,r,C1);
　　obtain_circle(C1,l,d,C2);
　　obtain_co_tagent(C1,C2,l1,1);
　　obtain_co_tagent(C1,C2,l2,0).
　　当然，由于图基的多样性，上述列举的都是较为基本的构造算子，是不尽完善的，更多的构造算子还需再深入研究与扩充.目前，这些基本算子能构造的图基包括：基本线素图基、简单几何图基、常用结构图基、轴类图基、部分套盖类图基、部分叉架类图基和薄板类图基等.
5　基于图基骨架自组织的信息模型
　　上节已说明图基是由一系列有序的构造算子列表示的.图基间的自组织是通过图基的骨架来获得自组织信息的，运用骨架信息来获得图基间的定位即变换信息.基于图基骨架自组织的数据模型如图14所示：其中实例零件组成元是由设计者根据设计需要从图基库中选择，并具体化，即输入必要的参数，以获得此图基的一个已定形实例.实例自组织信息和实例变换是对具体实例图基的操作，它们可从虚拟自组织信息和虚拟变换中获得对应的必要信息.


图14　基于图基骨架自组织的信息模型
6　基于图基骨架的自组织算法
　　基于图基骨架的自组织(参见图15)算法描述如下：


图15　基于图基骨架的自组织
　　(1) 若是初始零件设计，则从图基库中按序选择所需的图基，并输入必要的参数值，以实例化.同时建立相邻次序图基i和i+1间拼接线素所含线标架之间的对应关系，不妨称这两个线标架分别为图基i的右线标架（属图基i的那一个）和图基i+1的左线标架（属图基i+1的那一个）.否则转下一步；
　　(2) 对每一图基，计算其局部标架到左线标架（对基准图基来说，左线标架即为用以把该图基定位到世界坐标系中的那一个线标架）的坐标变换阵Si(i=1,2,…)；
　　(3) 把基准图基变换到左线标架中，再把它定位到世界坐标系W中的P（x0,y0）点，并计算其右线标架的新值；
　　(4) 把下一图基变换到左线标架中，再和位于世界坐标系中的基准图基自组织，满足其左线标架和基准图基的右线标架反叠（其它定位方式类同），计算此图基的右线标架的新值，重复执行步骤（4）直到按序历遍所有选用图基；
　　(5) 在W中显示由图基序列构成的零件图.
7　尺寸的转换
　　尺寸约束链一般有以下几种［7］：
　　(1) 这是最普遍之情形（参见图16），一般说来，构成尺寸约束链中的尺寸大都是长度尺寸，且尺寸线的方向一致.


图　16
　　(2) 有时尺寸约束链中的尺寸线的方向并不一致.如图17所示.


图　17
　　(3) 在一个视图中，尺寸约束链中的尺寸一般都是相连的，即两个尺寸共享一根尺寸界线.但是，有时并不相连.如图18所示.


图　18
　　在以图基为基本设计单元的零件图中，一般尺寸约束可分为以下两类：①图基内部的尺寸约束；②图基间的尺寸约束.我们的目标是把上述②的情况转化为①的情形.鉴于图基间线素的尺寸约束一般如图16中的尺寸L1所示，我们采用尺寸约束树的方法来解决这个问题.利用尺寸约束树，可以方便地把图基之间线素的尺寸约束（工艺约束）转化为各个图基内部线素之间的尺寸约束（形状约束）.如图16中图基A、C线素SA1和SC2之间有尺寸约束L1，SA1和SB1之间有尺寸约束L2，SB1和SB2间有尺寸约束L3，这些信息都记录在工艺约束数据库中（参见图19）.同时，由于图基A和图基B之间有重合定位线素SA2和SB1，图基B和图基C之间有重合定位线素SB2和SC1，所以这些信息都记录在图19的尺寸约束等价线素表中.从而由工艺约束数据库、形状约束数据库和尺寸约束等价线素表可以建立对应的尺寸约束树，其中无向实边连接两尺寸约束等价线素，虚边表形状约束尺寸，有向实边表工艺约束尺寸，有向实边的方向由该尺寸基准线素指向尺寸约束的另一线素.这时利用尺寸约束树可方便地将尺寸约束L1转化为图基C中的线素SC1和SC2之间的尺寸约束m，即根据尺寸约束树中有向实边的方向来确定尺寸的加减，例如：SC1和SC2间尺寸m,即为SB2和SC2间尺寸，在SB2沿有向实边至SC2的搜索路径中，从SB2到SB1处为逆向，尺寸取为负号（-L3），从SB1到SA1为逆向也取负号（-L2），从SA1到SC2为正向，即取正号（L1）.从而有：m=-L3-L2+L1，即尺寸m=L1-(L2+L3).


图19　基于尺寸约束树的尺寸转换
　　考虑到在产品造型中几何约束作为形状约束在前，作为工艺约束在后的特点，本文直接采用构造算子及自组织进行初始形状设计，并将形状约束作为高层抽象表示，将工艺约束作为低层抽象表示.需要指出的是，绝大多数的工艺约束表示都可以在初始设计完成后，从相应的形状约束自动转换而来，而有少量特别的约束，如图16中的L1，才需经过设计人员输入产生，并同时建立其与相关形状约束的关系.
8　过约束与欠约束的检测
　　由于零件分解为一系列图基序列，所以过欠约束的检测可利用尺寸约束树的尺寸转换方法限制到每个实例图基中，对于图基间的定位约束，一般不存在过欠约束问题，这些都为对零件图过欠约束的检测提供了方便.即若在某实例图基的所有必要参数中，存在参数没赋值，即为欠约束情形，存在参数有两个值以上即为过约束情况.
9　参数化设计
　　有了上述讨论的基础，我们现在已可以提出一种适用于图基自组织的参数化设计方法.主要步骤如下：
　　（1） 利用自组织方法给出实例零件的一个初始形状设计；
　　（2） 交互输入修改少量特别的工艺约束；
　　（3） 利用尺寸约束树的尺寸转换方法建立这些工艺约束与相关形状约束的关系；
　　（4） 实行过欠约束的检测.若有过欠约束的存在提示用户修改约束，否则转第5步；
　　（5） 对尺寸值进行变动设计.检查受所修改尺寸影响的所有实例图基，并对其形状和骨架进行修正.从中选出按序排在最前面的实例图基，利用自组织算法从此图基出发依序历遍所有排在后面的实例图基并重新实行自组织；
　　（6） 显示经修改后的零件图.
10　结论与实例
　　本文在基于二维高层次图素的参数化设计方面作了些初步工作，并且这些思想已初步上机实现.实践证明，本文的思路是正确的，方法是简便有效的.对于循环约束问题，由于工程图是由尺规按序作图完成的，所以一般是很少碰到的.对于这个在少量例子中存在的问题，我们正在进一步研究其有效解决办法.
　　下面给出一个利用上述方法来进行轴类零件参数化设计的一个实例，该轴类零件由4个轴类图基组成.


图20　轴类零件的初始设计（左）和改变尺寸后的图形（右）
本课题得到国家“八六三”计划基金（项目编号863-511-707-001）、国家教育部博士点基金（项目编号98033506）和浙江省自然科学基金项目（项目编号697010）资助.
作者简介：金建国，男，1971年11月生，博士研究生，主要研究方向为参数化设计造型、曲线曲面造型和真实感图形学.
　　　　　谭建荣，教授，博士生导师，主要研究领域为参数化设计及CAD/CAM.
　　　　　董玉德，1966年10月生，博士研究生，主要研究方向为参数化设计及服装CAD.
作者单位：浙江大学CAD & CG国家重点实验室　杭州　310027
参考文献
　1　　Light R, Gossard D. Modification of geometric model through variation geometry. Computer Aided Design, 1982, 14(4): 209～214
　2　　Aldefeld B. Variation of geometry based on a geometric reasoning method. Computer Aided Design, 1988, 20(3): 117～126
　3　　Koichi Kondo. PIGMOD: Parametric and interactive geometric modeling for mechanical design. Computer Aided Design, 1990, 22(10): 633～644
　4　　Buchanan S A et al. Constraint definition system: A computer-algebra based approach to solving geometric-constraint problems. Computer Aided Design, 1993, 25(12): 741～750
　5　　Nami Kin et al. Geometrical constraint solving based on the extended Boltzmann machine. Computers in Industry, 1992, 19: 239～250
　6　　Yaacov Hel-Or et al. Relaxed parametric design with probabilistic constraints. Computer Aided Design, 1994, 26(6): 426～433
　7　　谭建荣等.基于约束关系自组织的离线参数化技术.自然科学进展――国家重点实验室通讯，1996，6(6): 734～740
　　　(Tan jianrong et al. An off-line parametric design method based on constraint relation self-organization. Natural Science Evolution――State Key Laboratory Report(in Chinese). 1996, 6(6): 734～740)
原稿收到日期：1999-01-13；
修改稿收到日期：1999-04-26.
