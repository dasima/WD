计算机工程
Computer Engineering
1999年　第25卷　第9期　Vol.25 No.9  1999



集散式热处理控制软件设计
段隆振　江泽涛
　　摘　要　阐述了集散式热处理系统的工作原理，介绍了用Delphi开发上位机集工业控制及管理的软件设计思想及软件结构，并对主要功能进行了说明．
　　关键词　热处理；工业控制；集散式
The Software for Gathering_scattering Heat Treatment Control System
Duan Longzhen
(Department of Computer Science, Nanchang University, Nanchang 330029)
Jiang Zetao
(Department of Computer Science, Nanchang Institute of Aviation Industry, Nanchang 330029)
　　Abstract　This paper represents the working principle of gathering scattering heat treatment system. It introduces the design and structure of the gathering_scattering industry control and management software that is developed with Delphi and runs on top_computer end. It also shows main functions of the software.
　　Key words　Hot treatment; Industry control; Gathering scattering
　　随着科学技术的进步，对各种加工工艺及热处理过程提出了越来越高的要求，传统的机械手动式已难于满足现代化生产的需求。为此，开发出集散式热处理控制系统软件，即一台计算机控制多台下位机。下位机由MS_51单片机为核心，以热电偶为传感器控制可控硅导通角，从而控制电加热丝加热过程等组成下位机控制系统；上位机采用Windows95操作系统和Delphi3.0 设计，具有中文提示的GUI界面，操作简单直观，深受用户欢迎；该软件具有实时数据采集记录数据库，实时图形打印功能，图形再现功能，热处理原始数据记录数据库，热处理现场数据记录数据库等，大大方便了质量监测与跟踪管理，软件经过近一年的时间运行，未发生过一次差错，极大地方便了热处理监控及质量管理。
1　系统工作原理
　　(1)系统的构成与工作原理
　　整个系统由一台上位机，一台打印机，一个RS485接口及多台下位机组成，一台上位机最多可控制32台下位机，位机与下位机依靠串行通信方式相互传送信息，上位机与下位机通过地址取得相互联系，由RS485分址，上位机采用分时方式分别控制每一台下位机，上位机与下位机的最大距离为1500m，下位机根据设定的参数及通过热电偶测量的温度控制热处理炉的电热丝加热过程，如图1所示。

图1　系统工作原理
　　(2)下位机的工作方式
　　下位机有本机工作方式及通信工作方式，当工作在通信方式时，上位机可对下位机进行参数设定及控制，当工作在本机工作方式时，上位机不能对下位机进行参数设置及控制，但可以读取下位机的数据，这样即使某一台下位机坏了，但并不影响上位机对整个系统的控制，同样即使上位机坏了，各下位机照样可独立工作，这就使整个系统的稳定性大大提高。
　　下位机根据热处理工艺要求，可分为定值控制与程序控制两种工作方式，在定值工作方式下可设定热处理温度及保温时间；在程序工作方式下，最多可将整个热处理过程分为12个程序段，每个程序段可设定温度值及对应的保温时间，对整个程序可设定起始温度及循环控制次数，这样就可以满足自动控制各种较高要求的热处理过程。
　　(3)下位机的参数设定
　　下位机可在RAM模式和ROM模式下工作，在ROM模式时，系统采集到的数据写入EPROM，即便是突然停电，数据仍然得到保存，但EPROM可写寿命为10万次，因此一般不用ROM模式；在RAM模式时，系统采集到的数据写入RAM，当突然停电，数据不能得到保存，重新来电后从EPROM读入数据及操作指令工作，RAM模式无寿命限制，RAM模式为缺省工作模式，因此一般的工作方法是在不改变参数及指令时用RAM模式，当需要改变参数及指令时，一次性改用ROM模式，将参数及命令写入EPROM，然后立即改回RAM模式，这样既可保存改写的命令及参数，又可延长系统的使用寿命。
下位机可进行一些高级参数设定,非常有经验的技术员可设定P参数、I参数、D参数及自动整定温度值；系统程序中用反复迭代运算法可进行自动整定，所以对一般的操作人员可利用系统的自动整定功能获得PID参数；下位机可以设定控制的最高温度及最低温度；可设定报警参数，如超温偏差、欠温偏差，报警时间等。
2 上位机系统软件设计
　　上位机采用windows95操作系统下Delphi3.0编程，Delphi不仅是可视的完全面向对象的编程方法，而且可非常方便地操纵数据库及实现各种报表，使得编程较迅速。上位机软件要求界面优美、操作简单，上位机不仅能采集下位机的数据，而且可设定下位机的参数及控制下位机的运行。由于军工产品要有严格的质量跟踪管理，因此上位机不仅是控制系统，同时又是管理系统。考虑以上因素，上位机软件具有如下功能：
　　(1) 密码的安全管理
　　根据产品质量跟踪管理及热处理工艺操作要求，将上位机分为三级密码管理：一级密码为操作员掌握，用于系统的激活和一般的数据监控及报表管理；二级密码为技术员掌握，可以更改下位机的一般参数设定，如工作方式、运行模式、报警参数、极限参数等；三级密码为最高级密码，由总工程师或技术副厂长掌握，可以修改系统更高级参数，如PID整定、有权删除过时数据、有权修改整个系统密码等。由于采用了权限管理，有利于加强质量跟踪及责任管理。
　　(2) 数据监控及参数设定
　　上位机可选定开机炉号，根据所选的开机炉号对下位机进行检测及监控，上位机最多控制32台下位机。为便于管理，上位机采用分页方式管理，即每页管8台下位机，将屏幕上每页分为8个控制板面，每一板面对应一台下位机。板面上有温度设定值，温度测量值，保温时间，工作方式，超温、欠温、时间到报警状态，参数设定，开机关机等。参数殍定可根据密码权限对下位机的各种参数进行设定。
　　(3) 数据存储与图形功能
　　上位机采用对下位机分时循环监控工作方式，即使32台下位机全开，一分钟也可采集到二次数据。由于军工产品质量跟踪有严格要求，因此每一分钟内将采集到的数据存储一次到数据库中，并以图形方式实时地画在屏幕上。不同的温时曲线用不同的颜色加以区分，并可根据需要实时打印。对数据库中的数据可以用原始数据方式察看，也可用图形方式察看并打印。为加强对事故责任管理，报警记录每一分钟存储一次到数据库中，以便查阅。考虑到多数热处理工艺在40小时以下，每一分钟图形打点一次，为此将图形构件Image1.Width宽度设定为2400，这样利用滚动杠一次可看到采集40小时数据的图形，为了使操作员能在屏幕上固定区域看到最新采集的数据，采用下列过程图形似在坐标原点冒出而整个图形后移。
　　procedure MoveRect(Var t1:Real);
　　var r1,r2:TRect; 
　　　rgn:Hrgn;
　　　ty:Integer;
　　begin
　　　with Image1 do
　　　begin
　　　　Canvas.Brush.color:=ClTeal;
　　　　r1:=Rect(0,0,width,height);
　　　　r2:=r1;
　　　　rgn:=Creaetrectrgn(0,0,1,2);
　　　　scrolldc(canvas.handle,-1,0,HotGraphForm.r1,r2,rgn,nil);
　　　　deleteobject(rgn);
　　　　r1:=rect(2400,0,2401,height);
　　　　canvas.fillrect(r1);
　　　end;
　　　canvas.pixels[2400,(Height-trunc(t1)) div 4)]:=ClRed;
　　end;
　　(4) 数据报表
　　为加强质量跟踪管理，系统提供了热处理现场操作原始记录和热处理验收原始记录等数据报表的输入、查询、打印，表中提供了零件名称、零件图号、批次号、材料牌号、加热温度、保温时间、冷却剂、淬火温度、实测硬度、跟踪卡编号、操作员、检验员等，为分清责任事故，实现全面质量跟踪提供了有力保证。上位机软件流程图如图2。




图2 上位机软件流程图
3　结论
　　集散式热处理控制系统软件已在某导弹基地使用了一年多，运行稳定，未出现任何差错。该系统热处理温控精度达到±0.3℃，时间控制精度可达15s，深得用户好评。
作者简介：段隆振(1961～)，男，副教授，主要从事计算机应用技术研究
作者单位：段隆振　南昌大学计算机科学系，南昌　330029
　　　　　江泽涛　南昌航空工业学院计算机科学系，南昌　330029
收稿日期：1999-05-12
