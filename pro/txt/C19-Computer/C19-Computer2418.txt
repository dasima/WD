计算机研究与发展
JOURNAL OF COMPUTER RESEARCH AND DEVELOPMENT
1999年　第36卷　第11期　Vol.36　No.11　1999



基于类比的壁画色彩虚拟复原
魏宝刚　潘云鹤　华　忠
摘　要：文中以敦煌莫高窟为应用背景，介绍了基于类比的计算机辅助古代壁画色彩恢复方法.将色彩保持相对完好的壁画图像以及描述壁画属性的特征参数作为壁画色彩恢复的类比源存入数据库，根据决定和影响壁画色彩的不同因素，特征参数分为3个层次，以便于图像数据库的类比检索.为了在处理图像过程中与人的视觉保持一致，除RGB颜色空间外，又选择了SHI颜色空间.结合图像色彩区域提取、基于直方图的色彩转换等技术实现了壁画图像的色彩复原.
关键词：色彩恢复，类比，区域生长，色彩转换
中图法分类号：TP391
AN ANALOGY-BASED VIRTUAL APPROACH FOR COLOR
RESTORATION OF WALL PAINTING
WEI Bao-Gang, PAN Yun-He, and HUA Zhong
(Artificial Intelligent Institute, Zhejiang University, Hangzhou 310027)
(State Key Laboratory of CAD & CG, Zhejing University, Hangzhou 310027)
Abstract　A new computer-aided analogy approach for color restoration of ancient mural is proposed in this paper. The mural images whose colors are relatively intact are stored, along with their feature parameters used to describe the murals, into the database as the analogy source for color restoration of faded murals. The feature parameters are classified into three levels according to different factors that determine and affect the color of mural. The database can be retrieved from one or more than one level. In order to achieve a uniform perception with human vision, SHI color space is chosen. Several techniques for color image processing are used to process the mural image. These include color object extraction based on interactive region growing and color transformation based on color histogram.
Key words　color restoration, analogy, region growing, color transformation
1　引　言
　　中华民族在人类发展史上创造出了与古埃及、古印度和两河流域并称于世的灿烂文明，遗存了极其丰富的文物古迹.书画特别是壁画艺术更是独具特色，其中敦煌莫高窟壁画上起十六国，下止元代，历史悠久，在世界享有很高的声誉.但壁画经千百年风日侵蚀等各种自然和人为因素的影响，损坏严重，色彩大多褪变，且这种现象仍在持续.
　　敦煌壁画色彩变化大体上分为褪色和变色两种现象.褪色是颜料色泽、饱和度的降低，以及色泽的鲜明感觉和相互之间对比度减弱；而变色则是颜料在长期的光和其它因素作用下，由一种色相变为另一种色相，使原来鲜明强烈的色调变得晦暗、模糊.变色的主要内部原因是颜料中的铅成分［1］.变色的外部原因有光照、氧气、温湿度、工业气体、霉菌、细菌等，其中阳光和温湿度是重要因素.
　　为了使人们能够欣赏到作品原来绚丽的色彩，艺术家在壁画临摹工作中做过一些色彩复原工作，但基本上是尝试性的，至今未大量开展.除了复杂的技术原因外，这种完全依赖手工的恢复临摹存在两个不可避免的缺陷，一个是其局限性，也就是说临摹往往凭借个人或少数人的经验知识；另一个是临摹的不可逆性，当对某一步工作不满意时，不可能撤消当前的工作，再返回到前面步骤从新开始.
　　采用计算机辅助方法虚拟恢复古代壁画色彩可以有效地克服上述两个缺陷.首先可以将不同专业有关壁画色彩的研究成果、经验知识加以归纳、抽象、存储，并应用于虚拟色彩恢复中.此外，在恢复过程中随时可以放弃某一步的工作，从新开始，直到取得满意结果为止.
2　基于类比的色彩恢复
2.1　色彩恢复知识的分类
　　敦煌壁画有着一千六百多年的历史，颜料的成分既有矿物质的，也有植物质的；影响颜料变色的因素既有物理的，化学的，也有生物的；不同成分、不同色彩颜料的混合使得变色情况差别很大；颜料的使用又与绘画的风格、内容、技法等相关；而不同时期、不同画派有着不同的绘画技法.所有这些一环套一环，错综复杂.因此，要想恢复变色壁画的色彩必须利用所有可能的研究成果、经验知识.概括起来有以下三大类知识.
　　第1类是艺术家长期积累的经验知识.这类知识通常是在参阅历史文献和有关图片，考证衣冠制度、发髻装饰和风俗习惯，仔细研究不同时代壁画的色调、色种以及颜料的质量等基础上总结得出的，具有普遍的指导意义.比如，段文杰先生［2］阐述隋代壁画的人物面部立体感的表现方法时，概括出了中西合壁晕染法、中国传统晕染法、中国素面、以及天竺遗法等4种赋色方法.
　　第2类是壁画保护科学工作者的知识.这类知识是通过颜料的化学实验分析得出的颜料变色机理，这类知识较准确地反映了含铅颜料色彩的变色规律.比如铅丹(Pb3O4)在阳光照射下从桔红色到棕红，最后变为黑红色.
　　第3类知识来自于壁画自身.由于年代久远、环境条件的变更等客观原因，要想全面、准确地掌握壁画不同成分颜料的化学变化规律和壁画的赋色方法是不可能的.因此，壁画本身作为知识源的作用尤为突出，这里指的是未变色或变色程度不严重的作品，特别是通过对重层壁画剥出的色彩鲜亮作品.本文只针对这类知识，介绍基于类比的壁画色彩恢复技术方法.
2.2　基于类比的色彩恢复模型
　　利用类比机制进行学习和解决问题是人类智能的一大特点.当面临两幅内容相似的壁画时，我们很自然地会将两者的色彩联系起来，看看它们是否也具有某些相似性.例如，图1中两幅图像是同处428窟的两幅壁画，都是以菩萨为主.研究表明两幅壁画菩萨的肤色原来应该有相似的色彩，现在之所以呈现两种完全不同的色彩，主要是环境条件造成的.左图所示的壁画由于受光照的影响，变色较严重，原来的肉红色变成灰色，朱色叠晕已变成大黑圈.而右图所示的壁画由于佛龛遮蔽，不易受光，人体的肉红色以及朱色晕染仍然比较清晰.


图1　428窟不同光照条件下的壁画
　　除了这种同一洞窟中内容相似的壁画具有可比性外，属于同一时期或同一朝代，甚至是不同朝代的，但绘画风格、技法相似的壁画也具有一定的类比性.因此，将色彩保持相对完好的壁画图像连同其相关的特征信息作为类比源存储、利用，是我们色彩恢复系统的一个主要功能.
　　基于类比的色彩恢复过程（见图2）为：① 输入变色图像和相关的特征信息；②通过类比检索从数据库中检索出用于变色图像色彩恢复的参照图像；③ 根据要恢复的色彩从两个图像中提取对应的色彩区域；④ 确定变色色彩和恢复色彩的转换关系，完成色彩的恢复；⑤ 若对结果不满意可返回前面某步重新开始.


图2　基于类比的色彩恢复
2.3　数据库的组织和类比检索
　　数据库用来存储作为类比源的图像数据和壁画特征属性.当系统面对一个输入的变色壁画图像和特征信息时，为了使系统能够比较准确和快速地从数据库中检索出参照图像，数据库应该包括哪些特征信息以及数据库如何组织显得尤为重要.
　　除了图像数据外，我们将数据库分成3个层次，分别对应壁画的色彩结构、绘画技法和环境条件.在色彩结构这一层上，图像按壁画所处的洞窟、时代、朝代等决定色彩总体分布的属性分类；在绘画技法层上，图像按壁画主题、内容、风格以及绘画技法等属性分类.如壁画的内容分佛教、经变、装饰、菩萨、供养人等；在环境条件层图像按洞窟的温湿度、光照、大小、壁画在洞窟内的位置等与壁画的变色程度相关的属性分类.而实际图像按各层次所划分的类链起来.在这个库结构中，对应每一条链路及定义在其上的属性是一幅具体壁画的条理性分析，因而它是抽象知识的一种具体表达形式.
　　类比检索可在多条链路上同时进行，也可在某条链路上单独检索.一般来讲多链路检索结果比单链路检索结果更有效，但由于多链路所附加的约束条件更多，往往得不到结果，这时只能进行单链路检索.不同链路以及不同属性赋予不同的权值，设第i条链路权值为ωLi、它的第j个属性权值为ωAij，当检索出多个图像时，按权和的大小排列它们，供系统取舍和使用.计算权和公式为

　　SLi和SAij用以表示链路和相应层次上的属性是否与输入图像匹配，若匹配取值为1，否则为0.
3　图像色彩区域提取与色彩转换
　　对于壁画来说，由于绘画作品的色彩丰富，不同色彩相互融合，加之壁画表面的磨损、脱落等，使得壁画图像的处理更为复杂［3］.完全自动的彩色图像分割结果很难为进一步的图像处理所应用.因此，我们采用交互式的区域生长法来提取与恢复相关的色彩区域.这时颜色空间的选取对分割结果和效率有很大的影响.
3.1　颜色空间的选取
　　图像显示器采用红绿蓝三基色混合得到各种色彩，每个像素的颜色都是以三基色的数量来定义的，人们在处理彩色图像时往往采用RGB颜色空间.但RGB颜色空间不符合人的感知心理，例如很难说出深棕色中三基色R，G，B的准确含量到底是多少.因此，除RGB空间外，人们通过线性或非线性变换从三基色计算得出一些其它颜色空间，比如HSV，SHI，L*a*b*、I1-I2′-I3′，YES等.
　　在众多的颜色空间中选择哪种用于图像处理更好，一直为人们所重视. Schumeyer 和Barner［4］在RGB，L*a*b*，HSV，颜色空间上对3种不同肤色人脸图像进行了分割，结果是L*a*b*和HSV空间上所得的结果更好.Liu和Yang［5］用他们提出的多解彩色图像分割技术在RGB，HSV，I1-I2′-I3′，Lab，XYZ以及YIQ空间上对4幅典型的彩色图像进行了分割，分析了各颜色空间用于不同图像分割的结果，指出了它们的优缺点.Saber等［6］指出YES颜色空间有以下3个优点：① 降低了由于亮度改变所引起的色度变化；② 彩色分量E，S可由三基色移位变换得到，因此有较高的计算效率；③ 避免了非线性空间的奇异性.
　　从上述介绍的情况可以看出，颜色空间选取确实对分割结果起着重要的作用，但颜色空间及特征的选取，似乎不同的组合用于不同的目的［7］.针对壁画图像，我们选择SHI和RGB两颜色空间. SHI颜色空间在视觉上是均匀的，与人的颜色视觉有很好的一致性，它比较适合于人机交互式图像区域分割.但选择SHI颜色空间并非在整个色彩分布范围内都能取得理想的效果.实验表明饱和度分量S的取值范围对以色调分量H为主的图像分割结果有一定的影响.当s>20%分割结果比较可靠，而当s<10%时，分牲结果与视觉有较大的差距.因此，当s<10%或R，G，B 三分量值比较接近时，将直接在RGB颜色空间上分割图像.
3.2　交互式区域生长法
　　由于自动分割壁画图像满足不了实际要求，而且要处理的主要是变色色彩.所以，我们采用交互式的区域生长法提取色彩区域.这里所说的区域包括要恢复图像上的和参照图像上的两个色彩区域，且区域是非连通的，只要满足色彩相似性度量就被认为是目标区域.在区域生长过程中，种子点的位置和大小由用户交互选取.区域点聚类的距离度量标准为：

　　其中像素点(i,j)的色彩值为C(i,j)，它的相邻扩充点色彩值、生长区域的平均色彩值以及种子点的色彩值分别为和Cs(i,j)；δptp，δptr和δpts为3个阈值，它们的大小一般应满足δptp＞δptr＞δpts.
　　在区域生长过程中，若待定点的饱和度s<10%或其RGB分量大小接近时，颜色距离的度量采用RGB空间的欧几里德距离；否则用SHI空间的色调分量的差值衡量颜色距离.在区域边沿提取过程中，当区域的大小不超过5×5个像素时，将作为噪声不予以考虑.图3为变色菩萨肤色区域的交互式提取的部分结果.对于每个连通的子区域，至少需要一次交互确定种子点，当子区域色彩变化较大时，可能需要多次交互.


图3　交互式色彩区域提取
3.3　色彩转换及恢复
　　提取出彩色区域后，在SHI空间统计得出区域颜色直方图，由此确定恢复区域和参照区域的色彩分布，为色彩转换提供基础.我们采用了一种线性变换实现恢复区域中像素的色彩转换，其方法是根据两图像的H,S,I分量直方图，取各自峰值处的h,s,I值(HMs, SMs, IMs)和(HMc, SMc, IMc)作为参数，按下式求出所要恢复区域像素i的色彩值：

　　图4 为人体肤色的恢复效果对比，只取了整幅图像中所要恢复区域的局部为例.其中左图为未恢复前的图像，人物肤色呈灰色；中图为类比检索出的参照图像，人物肤色为肉红色；而右图为恢复后的图像.


图4　恢复结果对比
4　结　论
　　本文重点介绍了基于类比的壁画色彩虚拟复原技术方法.由于选择了SHI颜色空间，使得在交互提取色彩区域和恢复壁画色彩过程中，与人的视觉保持较好的一致性，且恢复色彩保持了绘画所产生的色彩层次关系.数据库的层次组织结构有助于准确高效地检索出所需要的图像.
　　虽然一般情况下恢复结果较好，但在色调变化较大的区域，采用线性转换色彩方式效果不甚理想.因此，我们进一步的工作将从两个方面入手，一个是研究非线性转换方法，另外还可以将色彩区域的提取与颜色分色结合起来，使得色彩的恢复可在某一色彩层上进行.
*本课题得到国家自然科学基金（项目编号69733030）和中国博士后基金项目资助.
作者简介：魏宝刚，男，1960年生，博士，副教授，主要研究方向为人工智能、图像处理、数据库与知识库系统.
　　　　　潘云鹤，教授，中国工程院院士，浙江大学校长，主要研究方向为人工智能、认知科学、智能CAD、计算机美术等.
　　　　　华忠，男，硕士研究生，主要研究方向为人工智能、图像处理.
作者单位：浙江大学人工智能研究所　CAD & CG国家重点实验室　杭州　310027
参考文献
1　李最雄. 石窟保护论文集. 兰州： 甘肃民族出版社，1994
　　(Li Zuixiong, Grottoes Conservation(in Chinese), Lanzhou: Gansu Folk Publisher, 1994)
2　段文杰. 敦煌研究文集――石窟保护篇. 兰州： 甘肃民族出版社，1993
　　(Duan Wenjie. Dunhuang Research(in Chinese), Lanzhou: Gansu Folk Publisher, 1993)
3　Lu Dongming, Li Xiangyang, Wei Baogang et al. Color restoration techniques for faded mural of mogao grotto. In: The proc of 4th Int'l Conf on Virtual Systems and Multimedia, VSMM98, Gifu, Japan, 1998. 630～635
4　Schuemyer R P, Barner K E. A color-based classifier for region identification in video, SPIE, 1998, 3308: 189～200
5　Liu J, Yang Y H. Multiresolution color image segmentation. IEEE Trans on Pattern Analysis and Machine Intelligence, 1994, 16(7): 689～700
6　Saber E, Tekalp A M, Bozdagi G, Fusion of color and edge information for improved segmentation and edge linking, Image and Vision Computing, 1997, 15(11): 769～780
7　魏宝刚，李向阳，鲁东明等. 彩色图像分割研究进展. 计算机科学，1999，26(4): 59～62
　　(Wei Baogang, Li Xiangyang, Lu Dongming et al. Development of color image segmentation. Computer Science(in Chinese), 1999, 26(4): 59～62) 
原稿收到日期：1999-02-08；修改稿收到日期：1999-07-16.
