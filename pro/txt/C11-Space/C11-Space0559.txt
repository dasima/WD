航空计测技术
AVIATION METROLOGY & MEASUREMENT TECHNOLOGY
1999年　第19卷　第6期　Vol.19　No.6　1999



IMP S-网络接口通信可靠性的改进
沈辉中
　　摘要　由于在S-网络上的IMP S-网络接口在线路上存在自身的缺陷，住往使其与主控计算机之间的通信受阻。本文从线路上改进了IMP S-网络接口，从而使通信更加稳定、可靠。
　　关键词　IMP S-网络接口　缺陷　主控计算机　通信　改进
Improvement of IMP S-Net Interface Communication
Shen Huizhong
　　Abstract　Owing to the IMP S-net interface on the S-network exists a defect upon itself in the circuit,the communication between IMP and host computer will be baffied frequently.In this paper,the IMP S-net interface is improved on the circuit,thus the communication can be stable and reliable.
　　Key words　IMP S-Net interface,Defect,Host computer,Communication,Improvement
　　IMP(Isolated Measurement Pod)数据采集器是微机监控技术应用于工业现场的一种新产品，由输力强仪器公司所研制。它综合了数据转换和通信技术,与IBM PC系列\,INTEL系列及PDP等各种微型机组成分布式数据采集与控制系统。实现了远程数据采集处理和过程控制。
　　IMP在现场应用中可分散安装，并特别适应恶劣的现场环境，系统组成简单，测量精度高，抗干扰性能强，使用方便，因此在国内已得到了广泛应用。但有少部分用户使用中的IMP工作站出现了主控计算机与工作站联机不通的问题，本人在维修工作中发现，这种情况并非是软件问题，也不是硬件损坏，而是网络本身的缺陷所致；改进了S-网络接口部分线路后，主机S-网络接口与工作站S-网络接口联机通畅，通信更加稳定、可靠。
　　下面介绍IMP通信网络――S-网络及笔者在线路上的一点改进。
1　IMP的通信网络
　　在分布式数据采集与控制系统之间采用了串行通信结构，(见图1)在IMP与主控计算机之间的联系仅仅采用了一根双绞电缆为通信介质所构成的网络，这种网络称为S-网络。网络中的这根双绞线不仅用来传送数据，也用来作IMP的供电电线。



图1　主机中S-网络适配器与IMP中的S-网络接口的连接
　　IMP的通信网络是总线式结构连接，采用主从方式进行工作，由一台计算机对整个网络中的工作站进行控制，其基本结构如图2，一台主控计算机最多可连接控制50个IMP工作站。


图　2
2　S-网络的通信
2.1　S-网络通信可分为两个部分
　　1)用户和主机之间的交互作用所需的软件部分，这部分软件也可由用户编写。
　　2)主机和IMP之间字符序列的传送部分。
　　这部分碰到的问题是对主机传送出的信息，IMP工作站没有反应，主机显示IMP工作站没有找到，下面先简单介绍一下S-网络通信的基本情况。
　　上面已经说过，S-网络中采用的通信方式是以串行结构方式进行的，主机和IMP之间互相传送的是由12位字构成的字符串，由若干字符串组成一个字符序列。在S-网络中采用了三种类型的字符序列，即信息序列、轮询序列和非确认序列。
　　a.信息序列。由主控计算机向IMP工作站发送命令，或各工作站向主机传送测量数据。信息序列的结构如图3．


图　3
　　b.轮询系列。轮询序列是由主控计算机启动某一块IMP发送数据，依次查询各块IMP工作站。并依次显示在屏幕上。字符序列结构如图4．


图　4
　　c.非确认序列。如果IMP被启动发送数据，但数据尚未准备好，则用非确认序列进行回答。字符序列结构如图5．


图　5
2.2　S-网络通信序列结构
　　S-网络通信序列结构见图6。


图　6
　　每个序列都是从地址的第一个地址字节开始，多于50个工作站时就为两个地址字节。按下来是确定字符序列性质的控制字符，是信息序列还是轮询序列、或非确认序列。然后是命令或是测量的数据(均作为信息序列)。信息序列最多可传送256个字符，在最后一个信息序列传送后，使用文本结束控制字符来结束信息序列。最后是出错校验。
2.3　字符格式
　　通过序列发送的每个字符均由12位组成：1个开始位，8个数据位，1个控制位和2个停止位(见图7)。


图7　字符传送的格式
3　S-网络的数据传输
　　在S-网络的数据传输中,“0”是1个bit输送周期出现的一个双向脉冲的表示，这个双向脉冲只占半个周期，如图8示。


图8　主控计算机向IMP发出的一个4 bit数据序列
　　之所以S-网络要用双向脉冲，是因为正脉冲所积累起来的电荷在负向脉冲到来时得到部分消除，再有后半个周期的延时能使积累的电荷充分泄放。
　　数据“1”是在这个bit周期内无脉冲出现。
　　如果IMP工作站向主控计算机发出的脉冲序列为负向脉冲在前，正向脉冲在后，如图9示。


图9　由IMP传送到主控计算机的一个4 bit数据序列
　　在S-网络上传送的各种信息，都是由一串12位的二进制码组成，其中第1位总是0；第2～9位为数据位；第10位为控制位；第11～12位是停止位。
4　S-网络的电源传输
　　S-网络中的双绞电缆不仅用于数据通信，又用作IMP供电电缆。在IMP内部大部分器件采用CMOS器件，功耗低，即每块只有1～2 W，一般直接由主机电源供电，当IMP多线路长时，也可外部供电。
5　S-网络的主要特点及不足之处
　　S-网络是异步双向通信网络，最长通信距离可达1500 m，以163 kb／s的传送速率传送信息，对于1000个通道的数据可在1 s内完成测量和传送。任何一种类型的IMP可挂在网的任何地方，适应性强。
　　由于S-网络处于长距离的高速率输送。传输线路上的分布电容不可忽视，虽然S-网络数据输送上采取了双向脉冲的输送序列，双向脉冲相对地抵消了一部分由分布电容引起的电荷积累，一旦分布电容引起的电荷积累不能完全充分泄放，就会造成失真，引起通信终断，联机不通。这种情况曾多次出现，用户送来的故障板，经检查硬件未损坏，和主机接口联机后，没有任何改变，偶然会联通一次，工作正常，但大多情况联不通。
　　下面试分析一下出现这种情况的原因
　　IMP工作站中S-网络接口实际电路图如图10。


图10　IMP工作站中S-网络接口图(C403电容是改进后增加上去的)
　　由主控计算机传送到工作站S-网络接口的双向脉冲，经过比较器IC401译码成TTL脉冲，这个TTL脉冲是工作站中ULA电路所认可的，对其它任何脉冲ULA一概不理睬(见图11)。


图　11
　　如果主控计算机传送进来的双向脉冲，经过传送产生畸变，如图12。这种畸变的输入脉冲，根本无法被比较器译码或者即使比较器能输出一个同样的畸变信号，但工作站中ULA不能认定，同样不确认。所以出现了主控计算机与工作站联机不通的情况。屏幕信息为IMP'S没找到。



图　12
　　为了解决这个问题，笔者在IC401的第三和第六脚到0 V之间加上一只150～250 pf的小电容,情况立即得到改善，主控计算机与工作站通信得到恢复，从示波器上看，畸变的脉冲正常了。
　　实践证明，加上电容后对原来能正常工作的工作站没有影响。而加上了这个电容之后，传输情况之所以会得到改善，是因为未加电容前，电容C401只是起到耦合作用，它仅仅是一只耦合电容，只是把主控计算机传送来的字符串耦合到比较器IC401的输入端进行译码，同时也起到隔直流作用。加上电容C403后，等于C401串联了电容C403到地。如图13所示。



图　13
　　很容易看出，这个等效电路已构成了一个积分电路，C401是这个积分电路中的一部分。这样从性质上改变了C401的作用。由于C403是与C401串联， 因此电容值要比原来小，此积分电路对传送来的字符串起到加速作用。而对畸变了的字符串脉冲，由于积分电路的加速作用，使它的脉冲前沿变得陡峭。如图14。


图　14
　　畸变了的字符串信号得到了恢复。从而使字符串能顺利地被比较器译码。
　　再者，原来线路的C401只是把传送来的字符串耦合到比较器的输入端，这个输入端的信号并不稳定。现在，C401和C403构成一个分压电路，传送到比较器输入端的信号是C401和C403的分压(见图15)，相对稳定了比较器的输入。


图　15
　　因此，在IMP网络中加上了电容C403后，能使S-网络的工作更加稳定可靠。
作者简介:沈辉中 59岁　男　高级工程师
作者单位:北京长城计量测试研究所，北京市1066信箱，100095
