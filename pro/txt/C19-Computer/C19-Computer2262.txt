计算机应用研究
APPLICATION RESEARCH OF COMPUTERS
2000　Vol.17　No.5　P.25-26



智能报表生成系统模型的研究与实现
万琳　陈传波
摘　要　提出了一种智能报表生成系统模型，模型中的报表知识库能以变化的用户需求为参数不断进行更新。这种报表功能能根据用户需求发展变化的机制，大大减轻了应用系统报表编制的后期维护工作，具有一定的智能和通用性。
关键词　报表数据字典 样式模板 报表样式字典 用户自定义样式模板文件包 知识库
1 引言
　　报表是应用系统中十分重要的部分，中国报表对样式繁杂的要求、用户需求的多样化加重了报表处理程序的编制和维护工作。一般应用系统的报表功能往往局限于系统发行时按用户当时需求定制的几种报表格式，对用户的要求低，但无法满足用户不断变化的需求，因此报表应用系统使用周期短、后期维护工作繁重。本文介绍了一种智能报表生成系统模型，模型以系统发行时能生成的报表为集合初值，以不断变化的用户需求为参数对应用系统的报表功能进行自扩展，以满足用户变化的需求。
2 模型实现的技术要点
2.1 报表格式分析
　　报表可看作一种格式化的文本，它的内容由一般样式和数据两部分组成。样式定义了报表的外观属性(包括数据展示的风格及报表采用的标题、图片等)；数据则包括基本数据和统计数据，它们按照指定的样式进行展示。
　　报表对象可定义为Report=<RName，Mode，Datasource">，其中：
　　(1)RName表示报表对象名；
　　(2)Mode表示报表的外观属性，即属性集Mode= {SubObject|Subobject=<subobjectname,description>}, SubobjectName为子对象名(子对象包括各种文本、线框、图片等)，Description是子对象属性的描述；
　　(3)Datasource表示数据源，即Datasource= {Dataitem|Dataitem=<itemname,description>，数据项Dataitem可为数据库中的表列(基本数据)或其计算结果(统计数据)，Itemname为数据项名，Desciption是数据项的描述(包括表列及计算方法)。
　　通过修改对象的Mode和Datasource可在应用程序执行时动态改变报表的外观和数据。
2.2  报表数据字典
　　报表数据字典记录了用户数据需求与数据源的映射关系。如果将用户的数据需求全集记为R，将数据源的全集记为T，定义R和T之间的映射关系Φ：R→T, Φ中包括了所有用户需求与数据源的对应关系，使得对于每个用户需求r(R，Φ(r)={t1, t2, ..., tn}=I，I为T的子集。每一组对应关系可用一有序对(r,I)来表示。
　　应用系统发行时，报表数据字典是系统设计人员根据用户需求定制的。随着需求的变化，用户可利用报表数据字典的可扩充性对其进行扩充，反映新的需求和数据源的对应关系。将报表数据字典中已有的用户数据需求集合记为R，则当用户提出数据需求r后，系统将启动数据搜索引擎并提供交互界面，寻找相关数据项，搜索算法如下：
　　(1) r∈R时，有序对(r, I)中I是与用户需求相关的若干数据项构成的子集;
　　(2) rR时，在需求的集合R中寻找与之模糊匹配的元素r'(可能不止一个)：
　　①如果存在有序对(r', I')，且其中的I'对应的子集能满足用户要求d，则将新的对应关系(r, I')记录在报表数据字典中；
　　②否则，搜索引擎程序将启动智能定项功能，供用户对数据项进行选择，并允许构造新的数据项(统计数据)，最后得到子集I，将有序对(r, I)记录在报表数据字典中。
　　如果把处理过程看作函数f，系统发行时的报表数据字典D0为函数的初值，用户的需求R为参数，D'表示结果，则D'=f(D0, R)。对于同一个函数，由于输入参数不同，会得到完全不同的处理结果，因此报表数据字典能根据不同用户的需要发展成为不同的报表数据字典。可用图1表示。

图1报表数据字典的自扩展
2.3  报表样式字典
2.3.1  样式模板
　　样式模板包括系统样式模板和用户自定义样式模板。系统样式模板是系统发行时定制的报表对象或对一般风格(如栅格式、标签式等)的样式示例；用户自定义样式模板实际上是一个报表文件，记载了用户定义报表对象的样式描述。
2.3.2  报表样式字典
　　报表样式字典则记录了用户样式需求与样式模板的对应关系。我们可用一个有序对(r, m)来表示一种对应关系。其中r是用户对样式的某种需求，m是一种报表样式模板，定义为m<name, description, search>， name是样式模板的名称，description是样式特点的描述，search记录了样式模板实现时的搜索方法：对于系统样式模板，记录模板对应的系统对象的名称；对于用户自定义样式模板则记录其对应的文件的存储位置。
　　将报表样式字典中已有的用户样式需求集合记为R，则当用户提出样式需求r后，系统将启动样式搜索引擎，在样式数据字典中进行搜索，搜索算法如下：
　　(1)当r∈R时，有序对(r, m)中的m为满足用户需求的样式模板；
　　(2) 当rR时，在集合R中寻找与之模糊匹配的元素r'：
　　①如果存在(r', m')，且m'能满足用户需求，则算法结束；
　　②否则，由用户从样式模板全集中进行选择，如果模板集中没有能满足用户需要的样式，则启动样式定义导航器引导用户通过简单的选择定义新的报表样式m。
　　样式字典也具有可扩充性。用户可以根据样式定制过程的具体情况决定是否将m存放在“用户自定义样式模板文件包”中以及是否将(r', m')或(r', m)写入样式数据字典等。与报表数据字典相同，由于用户的需求不同，发行的报表样式字典也会根据不同用户的需要自扩展成为不同的结果。
3  模型的实现
　　报表智能生成系统模型如图2。其中，报表知识库由报表数据字典和报表样式字典构成，它们以专门的数据库表或文件的形式分布在服务器端和客户端；数据搜索引擎具有智能定项功能，样式搜索引擎具有样式定义导航器功能。执行模块根据用户的需求，从报表知识库取出信息并同时根据需要更新知识库：①表示对报表知识库进行修改；②表示从报表知识库中取出数据定义或样式定义信息。逐步求精，最终得到用户满意的报表定义；解释器则将用户对报表数据和样式的定义翻译为报表对象的合法语法(包括处理如何将数据定义中的数据项赋予样式定义中对应的属性等)，然后利用对象的动态技术生成新的报表或对报表对象进行修改。

图2智能报表生成系统模型
4  结束语
　　本文提出的智能报表生成系统模型通过对报表知识库的扩充，使系统的报表功能根据用户变化的需求进行扩展。这种机制具有一定的智能，大大减少了应用系统中报表的维护工作。这种报表生成系统能自成一体，在不同的应用系统中只需更新报表知识库即可，具有一定的通用性。
万琳(华中理工大学计算机学院 武汉 430074)
陈传波(华中理工大学计算机学院 武汉 430074)
参考文献
1，PowerBuilder 6.0使用开发技巧. 晓通数据库研究与发展中心
2，张大方. 基于Windows通用财务报表系统的设计与实现. 计算机工程与应用, No.1. 1998
3，Rechard Wiener, An Introduction to Object-Oriented Programming, Reading mass, 1988
收稿日期：1999-12-13
