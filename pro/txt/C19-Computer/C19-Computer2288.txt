计算机应用研究
APPLICATION RESEARCH OF COMPUTERS
2000　Vol.17　No.5　P.101-102



利用MSFlexGrid控件建立、编辑Fuzzy规则库
马莉　朱理达
摘  要  介绍一种利用MSFlexGrid控件以及动态加入的弹出式菜单建立和编辑Fuzzy规则库的软件方法。该方法的优点在于将MSFlexGrid控件的数据工作表的直观显示和弹出式菜单的灵活编辑性能相结合，提供了便捷、灵活、可视的模糊控制规则库的建立编辑方式，同时还讨论了面向对象知识库建立技术，在智能控制系统开发中具有重要意义。
关键词  Fuzzy规则库  VB  MSFlexGrid控件   面向对象 
1  引言
　　随着计算机技术和智能控制技术的飞速发展，模糊控制技术已渗透到工业控制和家用电器领域，应用前景十分广阔。然而，在实际开发模糊控制系统时，模糊知识库(规则库、模糊子集隶属函数的分布)的建立需要耗费大量的烦琐劳动，整个开发过程长且不可视，知识库的建立和修改需在软件人员指导下进行。这些都严重制约了模糊控制技术的推广应用。
　　Microsoft VB 是Windows 环境下开发速度最快的编程工具之一。近年来受到广大用户和程序开发人员的青睐 ，VB利用事件驱动的编程机制、新颖易用的可视化设计工具，可以高效快速地开发出Windows 环境下功能强大、图形界面丰富的应用程序系统。VB 提供的MSFlexGrid控件可以对表格数据进行显示和操作，在对包含字符串和图片的表格进行分类、合并和格式化时，具有完全的灵活性。利用MSFlexGrid控件可以建立可视化模糊控制器规则库用户界面。但是，MSFlexGrid控件不允许用户编辑被绑定或包含在控件中的数据，这给模糊规则库的建立和编辑带来极大不便。
　　通常为了实现对MSFlexGrid控件网格数据的编辑，将MSFlexGrid控件和TextBox组合，使得MSFlexGrid控件具有单元编辑功能。本文提出将MSFlexGrid控件与弹出式菜单结合，通过模糊控制器知识库数据，建立动态加入的弹出式菜单，满足了模糊控制知识库可视化编辑、灵活方便地建立和修改知识库的要求。在此基础上，采用类对象技术建立了模糊规则库对象，将规则库的属性和方法封装起来，使得模糊控制器开发系统建立在一种比较稳定的结构上，并具有较好的开放性。
2  模糊规则库的生成和编辑
　　模糊控制是模拟人类控制特征的一种语言控制器，它需要把有经验的操作者或专家的控制知识和经验制定出若干控制规则。控制规则的提取和选择是一个繁复的过程，可采用表格型输入方法。以二维模糊控制器为例，在模糊控制器窗口(表1)直接输入控制规则。
表1  模糊控制规则表

规则IFTHEN
＃EECDosPower
1零正大0.8正大
2正小负小1.0负中
3正中负小0.7正中
4负小正小0.5零
...............

　　二维模糊控制器的模糊规则具有下列形式：
　　IF X1 is A1 and X2 is B1 Then Zis C1
　　可以看出，表1中规则输入的标准模式由四部分组成：输入模糊变量X1的子集A1和输入模糊变量X2的子集A2(IF部分)，该条规则的置信度(Dos)和模糊输出变量Z的子集C1。模糊规则的编辑界面采用MSFlexGrid控件作为模糊规则库的二维显示载体，规则编辑采用弹出式菜单恰当地将动态装入的模糊变量子集名称置入对应的单元网格。
　　1) 弹出式菜单项的动态装入
　　弹出式菜单的动态装入是指菜单项的个数不固定，并且能够在需要时动态地装入。在模糊控制器设计平台中，输入输出模糊变量的模糊子集名称和个数是设计过程中确定的，需要综合运用菜单项的索引属性(Index)、标题属性(Caption)、可见属性(Visible)和菜单项的装入方法(Load Method)实现弹出式菜单的动态装入，为MSFlexGrid控件上的规则编辑提供灵活的操作方式。下面是具体的实现过程：
　　a) 在菜单编辑器中增加一个菜单项，标题任意，假定菜单项的Name属性是mnhotfile，并设置mnhotfile.Visible = False
　　b) 建立子菜单项，标题空白，Name属性是input1，更改其下标属性，使input1.Index = 0
　　c) 在程序中控制菜单项input1的动态装入。以下的代码实现了这项功能。
For I=1 to number_in1
　　Load input1(I)
　　Input1(I).Caption = mf_input1(I)
Next  I
其中number_in1为模糊输入变量X1的子集数，mf_input1()为设计时建立的输入变量X1的子集名称向量。根据规则库建立的要求可以建立若干个菜单项，分别对应输入变量X2、输出变量Z和置信度Dos。当在菜单编辑器窗口里设计好相应的弹出式菜单后，利用PopupMenu命令可以进行规则库的编辑。
　　2) MSFlexGrid 网格单元编辑
　　在表1所示的规则表中，每一个单元对应MSFlexGrid控件对象的一个网格。然而规则的条件和结论部分分别对应四个不同的菜单项，需要利用当前被激活的网格单元的MouseCol属性确定弹出式菜单项的名称。假设Grid1为MSFlexGrid控件对象的Name属性，并且要求只有按下鼠标左键时才能激活菜单，必须在grid1_MouseDown 事件过程中加入如下代码:
Private Sub Grid1_MouseDown (Button As Integer, Shift As Integer, 
　　x As Single, y As Single)
If Button = 1 And Grid1_MouseCol=1 
　　　　Then　PopupMenu mnhotfile
End  If
If Button=1 And Grid1_MouseCol=2
　　Then　PopupMenu mnsecndin
End If
.....
End Sub
　　上述代码段实现在MSFlexGrid控件对象当前网格处按下鼠标左键时，弹出恰当的菜单。通过单击所选择的菜单命令，将对应模糊子集的名称置入网格单元中。以下是第1列的网格单元编辑代码：
Private Sub input1_Click ( Index As Integer )
　　Grid1_Text = input1(Index). Caption
　　Grid1_CellAlignment = 4
End Sub
其中菜单数组的标题属性为模糊变量的子集名称。这样，通过鼠标驱动的弹出式菜单在不同网格单元的操作实现模糊规则表的编辑和建立。 
3  建立面向对象的知识库
　　模糊规则表建立了可视化的知识库编辑界面，规则表的描述应该按照一定的数据格式存储起来，便于对知识库的操作、评价和修改。面向对象程序设计方法是一种全新的设计和构造软件的思维方法，它在封装性、继承性、多态性等方面的特点，呈现出良好的应用前景。
　　模糊控制器的知识库呈现模块化、标准化的特点，适当对其抽象上升到“类”的高度，采用面向对象的方法设计模糊规则库，较传统的面向过程的设计方法具有可重用性和适应性。根据模糊规则库的模块结构，使用面向对象技术，模糊规则可抽象为：
Rule  Class
{
　属性:Condition1(条件1)
　　　Condition2(条件2)
　　　Conclusion (结论)
　　　Degree_of _Certainty(置信度)
　　　ID (规则索引号)
　行为:Min 推理()
　　　存储规则()
}
　　模糊规则库的类集合为：
　Rules  Class
{  
　属性：输入变量1名称
　　　　输入变量2名称
　　　　输出变量名称
　　　　模糊推理方法
　　　　模糊化方法
　　　　规则 of  Rule Class
　方法：添加规则
　　　　删除规则
　　　　访问规则
　　　　计数
　　　　Max推理()
　　　　解模糊运算()
}
　　以下代码将建立的规则库表格保存于知识库类对象。
Private M_rules As Rules
Private Sub cmdOk_Click()
　　Dim  I  As Integer
　　For  I = 1 To 50
　　　If RuleArray(I , 1) =
　　　M_rules.Add  RuleArray(I, 1), _
　　　RuleArray(I,2), RuleArray(I,3), _
　　　RuleArray(I,4)
　　Next
End Sub
　　采用创建类对象的方法封装了模糊规则库的属性、规则库管理和推理方法，与前述的模糊规则库生成和编辑界面相配合，实现了界面编辑的灵活性和规则库建立、管理、操作的模块化结构的统一。
4  结束语
　　文中介绍的VB编程方法已成功用于模糊控制器开发平台应用程序系统。利用MSFlexGrid控件以及动态加入的弹出式菜单建立和编辑Fuzzy规则库将MSFlexGrid控件的数据工作表的直观显示的优势和弹出式菜单的灵活编辑性能相结合，提供了便捷、灵活、直观的模糊控制规则库的建立编辑方式；同时，运用面向对象方法进行模糊知识库建立、管理和操作对智能控制系统开发具有重要意义。
本项目获国家计委重点科技项目《家用电器模糊控制技术应用研究》资助(项目编号：(96)2699)
马莉(郑州轻工业学院计算机系  郑州 450002)
朱理达(郑州轻工业学院图书馆  郑州 450002)
参考文献
1，王耀南. 智能控制系统. 长沙：湖南大学出版社, 1996年
2，曹  康, 于冬梅译. Visual Basic 5.0对象开发教程. 北京：人民邮电出版社, 1998年2月
3，张海藩. 软件工程导论. 北京: 清华大学出版社, 1992年
收稿日期：1999-10-9
